# v0.50.fix13

> çŠ¶æ€ï¼šâœ…
> è¯´æ˜ï¼šFix/Previewï¼šhover Markdown/LaTeX é¢„è§ˆæ”¹ä¸ºå¤ç”¨å…±äº« WKWebViewï¼ˆé¿å…é¢‘ç¹ create/destroyï¼‰ï¼Œå¹¶ä¿®å¤å¿«é€Ÿ re-hover å¶å‘ä¸å†å¼¹å‡ºã€‚

## ğŸ“Œ ä¸€é¡µçº¸æ€»ç»“ï¼ˆWhat / Why / Resultï¼‰

### What

- Fix/Previewï¼šMarkdown/LaTeX hover é¢„è§ˆè·¨è¡Œå¤ç”¨åŒä¸€ä¸ª `MarkdownPreviewWebViewController` / `WKWebView`ï¼ˆä¸å†æ¯è¡Œåˆ›å»º/é”€æ¯ï¼‰ã€‚
- Fix/Previewï¼šåˆ—è¡¨å±‚å…¨å±€åè°ƒ hover preview popoverï¼ŒåŒä¸€æ—¶åˆ»æœ€å¤šä¸€ä¸ªï¼ˆé¿å…åŒä¸€ä¸ª `WKWebView` åŒå¸§æŒ‚åˆ°ä¸¤ä¸ª view hierarchyï¼‰ã€‚
- Fix/Previewï¼šä¿®å¤ popover close ç«æ€å¯¼è‡´ hover task è¢«è¯¯å–æ¶ˆï¼Œå¼•å‘â€œç§»å¼€å…³é—­åå¿«é€Ÿå† hover åŒä¸€è¡Œä¸å†å¼¹å‡ºâ€çš„é—®é¢˜ã€‚

### Why

- é¢‘ç¹ hover é¢„è§ˆä¼šåå¤åˆ›å»º/é”€æ¯ WebKit ç›¸å…³å¯¹è±¡ï¼Œå®¹æ˜“å¯¼è‡´ `Web Content` è¿›ç¨‹æ•°å¢é•¿ã€å†…å­˜å ç”¨ä¸Šå‡ï¼Œä¸”çŠ¶æ€å›æ”¶éš¾ä»¥ä¿è¯ä¸€è‡´ã€‚
- macOS ä¸Š SwiftUI `.popover(isPresented:)` å­˜åœ¨â€œç³»ç»Ÿ dismiss ä½† binding ä¸å›å†™â€çš„æƒ…å†µï¼›å åŠ  close å›è°ƒæ—¶åºï¼Œä¼šå¯¼è‡´åŒä¸€è¡Œæ— æ³•å¯é é‡å¤æ‰“å¼€ã€‚

### Result

- hover é¢„è§ˆåªä¿ç•™ä¸€ä¸ªå…±äº« WebView å®ä¾‹ï¼Œæ˜¾è‘—é™ä½ WebKit å¯¹è±¡ churnï¼›popover å…¨å±€äº’æ–¥ä¸” re-hover æ›´ç¨³å®šã€‚

---

## ğŸ“‚ æ ¸å¿ƒæ”¹åŠ¨

- `Scopy/Views/HistoryListView.swift`
  - å¼•å…¥å…±äº« `MarkdownPreviewWebViewController`ï¼ˆ`@StateObject`ï¼‰å¹¶è·¨è¡Œå¤ç”¨ã€‚
  - æ–°å¢ `activePopover/pendingPopover` çŠ¶æ€æœºï¼Œå¼ºçº¦æŸåŒä¸€æ—¶åˆ»æœ€å¤šä¸€ä¸ª preview popoverã€‚
- `Scopy/Views/History/HistoryItemView.swift`
  - è¡Œè§†å›¾ä¸å†æŒæœ‰/åˆ›å»º WebView controllerï¼Œè€Œæ˜¯ä½¿ç”¨ä¸Šå±‚æ³¨å…¥çš„å…±äº«å®ä¾‹ã€‚
  - å¢å¼º popover close å…œåº•ï¼šç›‘å¬ popover window close å¹¶åšâ€œæ¡ä»¶æ¸…ç†â€ï¼Œé¿å…ç«æ€è¯¯å–æ¶ˆæ–°ä»»åŠ¡ã€‚

---

## âœ… æµ‹è¯•

- å•å…ƒæµ‹è¯•ï¼š
  - `xcodebuild test -scheme Scopy -destination 'platform=macOS' -only-testing:ScopyTests`
  - âœ… Executed 271 tests, 25 skipped, 0 failures
