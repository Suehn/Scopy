# v0.50.fix8

> çŠ¶æ€ï¼šâœ…
> è¯´æ˜ï¼šæ»šåŠ¨æ€§èƒ½åŸºçº¿/Profiling åŸºç¡€è®¾æ–½ + Mock æ•°æ®å¯é…ç½® + UI profile åœºæ™¯è¦†ç›– + hover é¢„è§ˆæ»šåŠ¨é®æŒ¡ä¿®å¤ã€‚

## ğŸ“Œ ä¸€é¡µçº¸æ€»ç»“ï¼ˆWhat / Why / Resultï¼‰

### What

- Perf/Profileï¼šæ–°å¢ ScrollPerformanceProfileï¼ˆç§»è‡³ ScopyUISupportï¼‰ï¼Œè¾“å‡º frame time P50/P95ã€drop ratioã€scroll speedï¼ˆJSONï¼‰ã€‚
- Perf/Profileï¼šæ»šåŠ¨æœŸé—´é‡‡æ ·å¸§é—´éš”ï¼ˆTimelineViewï¼‰ï¼Œå¹¶è®°å½•æ–‡æœ¬/å›¾ç‰‡/hover ç›¸å…³è€—æ—¶æ¡¶ã€‚
- Mockï¼šMockClipboardService æ”¯æŒæ•°æ®é‡/å›¾ç‰‡æ•°é‡/æ–‡æœ¬é•¿åº¦/ç¼©ç•¥å›¾é…ç½®ï¼Œæ”¯æŒåœºæ™¯çŸ©é˜µã€‚
- Testsï¼šæ–°å¢å¯é€‰ UI profile æµ‹è¯•å…¥å£ï¼ˆç¯å¢ƒå˜é‡å¯ç”¨ï¼‰ï¼Œè¦†ç›– baseline / text-only / image-heavyã€‚
- UX/Fixï¼šhover é¢„è§ˆæ”¶åˆ°æ»šè½®æ—¶è‡ªåŠ¨å…³é—­ï¼Œé¿å…é¢„è§ˆé®æŒ¡æ»šåŠ¨ï¼›UI æµ‹è¯•æ¨¡å¼ç‚¹å‡»è¡Œä¸å…³é—­é¢æ¿ã€‚
- Profileï¼šæ–°å¢ `profile_scenario` å­—æ®µï¼Œä¾¿äºå¤šåœºæ™¯å¯¹æ¯”ã€‚

### Why

- ç¼ºå°‘â€œçœŸå®æ»šåŠ¨å¸§æ—¶é—´ä¸æ‰å¸§æ¯”â€çš„åŸºçº¿ï¼Œæ— æ³•å®¢è§‚å®šä½ç“¶é¢ˆä¸å¯¹æ¯”æ”¹åŠ¨æ•ˆæœã€‚
- éœ€è¦åˆ†å±‚æ‹†è§£ï¼ˆæ–‡æœ¬/å›¾ç‰‡/hover/å¯è®¿é—®æ€§ï¼‰ä»¥å®šä½ä¸»å¯¼ç“¶é¢ˆã€‚
- hover é¢„è§ˆé®æŒ¡æ»šåŠ¨å¯¼è‡´åˆ—è¡¨éš¾ä»¥æ“ä½œï¼Œéœ€è¦æ˜ç¡®è¡Œä¸ºã€‚
- UI profile æµ‹è¯•éœ€è¦æ›´ç¨³å®šçš„æ»šåŠ¨ä¸èšç„¦ç­–ç•¥ã€‚

### Result

- å¯åœ¨ Debug/UITest æ¨¡å¼ç”Ÿæˆæ»šåŠ¨æ€§èƒ½ JSON æŠ¥å‘Šï¼ˆbaseline/text-only/image-heavy å‡å·²è·‘ï¼‰ã€‚
- ä¸æ”¹å˜ UI/è¡Œä¸ºï¼Œæ‰€æœ‰é‡‡æ ·ä¸é…ç½®å‡ç”±ç¯å¢ƒå˜é‡å¯ç”¨ï¼›hover é¢„è§ˆåœ¨æ»šåŠ¨æ—¶è‡ªåŠ¨æ”¶èµ·ã€‚
- åŸºçº¿ç»“æœï¼ˆ10k items + 2k thumbnailsï¼Œaccessibility onï¼‰ï¼šframe P50â‰ˆ16.7msã€P95â‰ˆ16.7msã€drop_ratioâ‰ˆ1.90%ã€‚

---

## ğŸ“‚ æ ¸å¿ƒæ”¹åŠ¨

- `ScopyUISupport/ScrollPerformanceProfile.swift`
  - ScrollPerformanceProfileï¼šframe time/drop ratio/scroll speed é‡‡æ ·ä¸ JSON è¾“å‡ºã€‚
- `Scopy/Views/HistoryListView.swift`
  - æ³¨å…¥ ScrollFrameSamplerViewï¼›æ”¯æŒ profile accessibility æ¨¡å¼ã€‚
- `Scopy/Views/History/ListLiveScrollObserverView.swift`
  - æš´éœ² scrollView attach å›è°ƒç»™ profilerï¼›å¢åŠ çª—å£çº§å›é€€æœç´¢ä»¥ç»‘å®š List çš„ scroll viewã€‚
- `Scopy/Observables/HistoryViewModel.swift`
  - scroll start/end åŒæ­¥ profiler çŠ¶æ€ã€‚
- `Scopy/Presentation/ClipboardItemDisplayText.swift`
  - æ–‡æœ¬ title/metadata è®¡ç®—è€—æ—¶å…¥æ¡¶ï¼ˆä»… profiling å¼€å¯æ—¶ï¼‰ã€‚
- `ScopyUISupport/ThumbnailCache.swift`
  - ç¼©ç•¥å›¾è§£ç è€—æ—¶å…¥æ¡¶ï¼ˆä»… profiling å¼€å¯æ—¶ï¼‰ã€‚
- `Scopy/Views/History/HistoryItemView.swift`
  - hover é¢„è§ˆå›¾ç‰‡ decode ä¸ Markdown render è€—æ—¶å…¥æ¡¶ï¼›æ»šè½®è§¦å‘æ—¶è‡ªåŠ¨å…³é—­é¢„è§ˆï¼›UI æµ‹è¯•é¢„è§ˆç‚¹å‡»ä¸å…³é—­é¢æ¿ã€‚
- `Scopy/Views/History/HistoryItemImagePreviewView.swift`
  - é¢„è§ˆå¯è®¿é—®æ€§æ ‡è¯†ï¼ˆUI æµ‹è¯•å®šä½ç”¨ï¼‰ã€‚
- `Scopy/Views/History/HistoryItemTextPreviewView.swift`
  - é¢„è§ˆå¯è®¿é—®æ€§æ ‡è¯†ï¼ˆUI æµ‹è¯•å®šä½ç”¨ï¼‰ã€‚
- `Scopy/Views/History/HistoryItemThumbnailView.swift`
  - ç¼©ç•¥å›¾å¯è®¿é—®æ€§æ ‡è¯†ï¼ˆUI æµ‹è¯•å®šä½ç”¨ï¼‰ã€‚
- `Scopy/Services/MockClipboardService.swift`
  - Mock æ•°æ®è§„æ¨¡/å›¾ç‰‡æ•°é‡/æ–‡æœ¬é•¿åº¦/ç¼©ç•¥å›¾é…ç½®å¯è°ƒã€‚
- `ScopyUITests/HistoryListUITests.swift`
  - æ–°å¢å¯é€‰ scroll profile UI æµ‹è¯•å…¥å£ï¼ˆç¯å¢ƒå˜é‡æˆ–è§¦å‘æ–‡ä»¶å¯ç”¨ï¼‰ï¼Œè¦†ç›– baseline/text-only/image-heavyï¼›æ–°å¢ hover preview dismiss æµ‹è¯•ä¸æ»šåŠ¨ç¨³å®šæ€§å…œåº•ã€‚

---

## ğŸ§ª Profiling é…ç½®

### åŸºçº¿é‡‡æ ·

- å¯ç”¨ï¼š`SCOPY_SCROLL_PROFILE=1`
- è¾“å‡ºï¼š`SCOPY_PROFILE_OUTPUT=/tmp/scopy_scroll_profile.json`
- æŒç»­ï¼š`SCOPY_PROFILE_DURATION_SEC=6`
- æœ€å°æ ·æœ¬ï¼š`SCOPY_PROFILE_MIN_SAMPLES=180`
- æ‰å¸§é˜ˆå€¼ï¼š`SCOPY_PROFILE_DROP_THRESHOLD=1.5`
- æœŸæœ›å¸§æ—¶é•¿ï¼ˆå¯é€‰ï¼‰ï¼š`SCOPY_PROFILE_EXPECTED_FRAME_MS=16.7`
- æœ€å¤§æ ·æœ¬ï¼ˆå¯é€‰ï¼‰ï¼š`SCOPY_PROFILE_MAX_SAMPLES=2000`
- åœºæ™¯æ ‡è¯†ï¼ˆå¯é€‰ï¼‰ï¼š`SCOPY_PROFILE_SCENARIO=baseline-image-accessibility`

### Mock æ•°æ®è§„æ¨¡

- è®°å½•æ•°ï¼š`SCOPY_MOCK_ITEM_COUNT=10000`
- å›¾ç‰‡æ•°ï¼š`SCOPY_MOCK_IMAGE_COUNT=2000`
- æ–‡æœ¬é•¿åº¦ï¼š`SCOPY_MOCK_TEXT_LENGTH=512`
- ç¼©ç•¥å›¾å¼€å…³ï¼š`SCOPY_MOCK_SHOW_THUMBNAILS=1`

### å¯è®¿é—®æ€§å¯¹æ¯”

- `SCOPY_PROFILE_ACCESSIBILITY=1`ï¼ˆå³ä½¿é UITest ä¹Ÿå¯ç”¨è¡Œçº§ accessibility æ ‡è¯†ï¼‰

---

## âœ… æµ‹è¯•

- UI profile æµ‹è¯•å…¥å£æ–°å¢ï¼ˆé»˜è®¤è·³è¿‡ï¼‰ï¼š
  - `ScopyUITests/HistoryListUITests/testScrollProfileBaseline`
  - `ScopyUITests/HistoryListUITests/testScrollProfileTextOnly`
  - `ScopyUITests/HistoryListUITests/testScrollProfileImageHeavyNoAccessibility`
  - `ScopyUITests/HistoryListUITests/testHoverPreviewDismissesOnScroll`
  - è¿è¡Œéœ€è®¾ç½® `SCOPY_RUN_PROFILE_UI_TESTS=1` æˆ– `touch /tmp/scopy_run_profile_ui_tests`
  - å®æµ‹å‘½ä»¤ï¼š`SCOPY_RUN_PROFILE_UI_TESTS=1 xcodebuild test -scheme Scopy -destination 'platform=macOS' -only-testing:ScopyUITests/HistoryListUITests`

---

## ğŸ”® é—ç•™ä¸åç»­

- è‹¥ frame time ä»é«˜äºç›®æ ‡ï¼ŒæŒ‰æ¡¶è´¡çŒ®ä¸åœºæ™¯å·®åˆ†ç¡®å®šä¸‹ä¸€å±‚ä¼˜åŒ–ã€‚
