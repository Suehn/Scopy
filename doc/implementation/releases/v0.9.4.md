# v0.9.4 - 搜索分页修复 & 复制兜底

## 📌 一页纸总结
- **What**: 修复内联富文本/图片复制失效、过滤搜索被 50 条截断、图片去重误判；搜索执行移至后台队列降低主线程阻塞。
- **Why**: 确保无限历史 + 分级存储可用性，避免用户无法粘贴小内容、过滤结果缺失，提升稳定性与性能一致性。
- **Result**: 复制路径兜底完善，过滤/搜索分页恢复全量可见性，图片去重使用内容哈希，搜索 I/O 后台化。

## 🏗️ 实现路线
1. 复制兜底：`copyToClipboard` 优先内联数据，再回退外链，覆盖 RTF/HTML/PNG。
2. 搜索修复：空查询+过滤改走 SQLite 全量；`loadMore` 支持搜索/过滤分页；搜索/缓存刷新后台队列执行。
3. 去重校正：图片哈希改用后台 SHA256，避免轻指纹误判。
4. 测试补充：过滤空查询与分页单测、内联 RTF 复制集成测试。

## 📂 核心改动
- `Scopy/Services/RealClipboardService.swift`：复制路径兜底内联数据。
- `Scopy/Services/SearchService.swift`：空查询过滤直连 DB、FTS/缓存刷新后台队列、过滤分页。
- `Scopy/Observables/AppState.swift` & `Scopy/Views/HistoryListView.swift`：搜索/过滤分页 loadMore。
- `Scopy/Services/ClipboardMonitor.swift`：图片哈希改为后台 SHA256。
- Tests: `SearchServiceTests`, `IntegrationTests` 新增覆盖。

## 🎯 关键指标
- 搜索延迟（RUN_HEAVY_PERF_TESTS=1）：5k P95 1.95ms、10k P95 16.21ms、25k（磁盘）P95 55.00ms、50k P95 125.94ms、75k P95 195.77ms、20k Regex P95 0.77ms。
- 外部存储清理：300×256KB（约 195MB）写入后清理至 50MB，耗时 653.84ms（SLO < 800ms）。
- 测试：性能测试 19/19 ✅；其他单元/UI 测试沿用上一版结果（建议本地或 CI 跑全套）。

## 📊 当前状态
- 复制：内联 RTF/HTML/PNG 可正确回写剪贴板。
- 搜索：空查询+过滤返回全量，分页可继续加载；短词缓存仍在（后台刷新）。
- 去重：图片按内容哈希去重，避免误覆盖。

## 🔮 遗留与后续
- 建议补充：大文件/外部存储并发访问的线程安全验证；完整性能基准与 UI 回归测试。
- 如需进一步优化：Storage I/O 下沉后台队列，添加搜索/复制相关的性能监控样本。
