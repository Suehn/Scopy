# v0.50.fix20

> 状态：✅
> 说明：Feat/Preview：文件条目 hover 预览接入系统 Quick Look（PDF 可滚动、视频可播放），.md 文件读取并渲染 Markdown；文件备注可编辑并参与搜索，元数据展示真实文件大小+备注。

## 📌 一页纸总结（What / Why / Result）

### What

- Feat/Preview：普通文件 hover 预览接入系统 Quick Look（Space 预览）视图，PDF 可滚动多页、视频可播放；.md 文件读取并渲染 Markdown。
- Fix/Preview：视频 hover 预览尺寸贴合视频比例，减少黑边。
- Fix/Preview：Markdown 文件 hover 首次预览改为加载占位，避免纯文本/Markdown 闪烁切换。
- Fix/Preview：Markdown 文件预览不再触发文本预计算，避免 popover 被切换/闪烁。
- UX：文件条目元信息回到标题下方左对齐，优先保证缩略图尺寸。
- UX：备注编辑弹窗样式一体化，编辑时不再触发 hover 预览干扰。
- Feat/Files：文件条目支持右键备注编辑/清空，备注写入存储并参与搜索。
- UX：文件元数据展示真实文件大小 + 备注，不再显示路径文本大小。

### Why

- 文件条目的 PDF/视频/Markdown 预览缺失或不稳定，交互体验不足。
- 需要为文件条目提供可搜索的备注，并显示真实文件大小。

### Result

- 文件条目 hover 预览覆盖 PDF/视频/Markdown，PDF 可滚动多页，视频可播放且尺寸贴合内容。
- 文件备注可编辑并可被搜索；元数据展示真实文件大小 + 备注。

---

## 📂 核心改动

- `Scopy/Utilities/FilePreviewSupport.swift`
- `Scopy/Application/ClipboardService.swift`
- `Scopy/Services/StorageService.swift`
- `Scopy/Infrastructure/Search/SearchEngineImpl.swift`
- `Scopy/Infrastructure/Persistence/SQLiteMigrations.swift`
- `Scopy/Infrastructure/Persistence/SQLiteClipboardRepository.swift`
- `Scopy/Presentation/ClipboardItemDisplayText.swift`
- `Scopy/Views/History/HistoryItemView.swift`
- `Scopy/Views/HistoryListView.swift`
- `Scopy/Views/History/HistoryItemFileNoteEditorView.swift`
- `Scopy/Views/History/HistoryItemFileThumbnailView.swift`
- `Scopy/Views/History/HistoryItemFilePreviewView.swift`

---

## ✅ 测试

- ⏸ 未运行（按需可跑：`xcodebuild test -scheme Scopy -destination 'platform=macOS' -only-testing:ScopyTests`）
