# Scopy v0.6 - UI/UX 改进与功能增强

**发布日期**: 2025-11-27

---

## 一页纸总结

### What
v0.6 专注于 UI/UX 改进和功能增强：
1. **修复鼠标悬停选中问题** - 鼠标移动不再改变列表选中状态
2. **动态版本号显示** - 设置窗口显示真实版本号和构建日期
3. **设置窗口多页重构** - TabView 三页结构（通用、存储、关于）
4. **修复文件复制问题** - 文件 URL 正确序列化，支持 Finder 粘贴

### Why
用户反馈的体验问题：
- 鼠标移动时列表选中项会跳动，影响键盘导航体验
- 版本号硬编码为 "0.4"，无法反映实际版本
- 设置窗口功能单一，缺少存储统计和版本信息
- 复制文件时只能粘贴文件名，无法粘贴实际文件

### Result
- 鼠标和键盘导航完全分离，体验流畅
- 版本号自动从 Bundle 获取，构建日期动态显示
- 设置窗口功能完整：快捷键配置、搜索模式、存储统计、关于页
- 文件复制后可在 Finder 中正常粘贴

---

## 实现路线

### Phase 1: 修复鼠标悬停选中问题
1. 定位问题：`HistoryListView.swift` 中的 `.onHover` 修饰符
2. 移除 `onHover` 处理器，保留点击和键盘选中

### Phase 2: 版本号动态显示
1. 配置 `project.yml` 添加 `MARKETING_VERSION` 和 `CURRENT_PROJECT_VERSION`
2. 创建 `AppVersion.swift` 工具类读取 Bundle 信息
3. 更新设置窗口使用动态版本号

### Phase 3: 设置窗口多页重构
1. 重构 `SettingsView.swift` 为 TabView 结构
2. 创建三个 Tab：General、Storage、About
3. 添加 `StorageStatsDTO` 和 `getDetailedStorageStats()` 接口
4. 实现快捷键录制 UI（占位）、搜索模式选择器
5. 实现存储统计显示和手动刷新

### Phase 4: 修复文件复制问题
1. 修改 `ClipboardMonitor.swift` 序列化文件 URL 到 `rawData`
2. 添加 `serializeFileURLs()` 和 `deserializeFileURLs()` 方法
3. 添加 `copyToClipboard(fileURLs:)` 方法
4. 修改 `StorageService.StoredItem` 添加 `rawData` 字段
5. 更新 `RealClipboardService.copyToClipboard()` 使用文件 URL

---

## 核心改动

### 新增文件
| 文件 | 用途 | 行数 |
|------|------|------|
| `Utilities/AppVersion.swift` | 版本信息工具 | ~35 |

### 修改文件
| 文件 | 改动 |
|------|------|
| `project.yml` | 添加版本号配置 |
| `Views/HistoryListView.swift` | 移除 onHover |
| `Views/SettingsView.swift` | 完全重写为 TabView 结构 |
| `Protocols/ClipboardServiceProtocol.swift` | 添加 StorageStatsDTO、getDetailedStorageStats() |
| `Services/StorageService.swift` | StoredItem 添加 rawData 字段 |
| `Services/SearchService.swift` | parseItem 添加 rawData 解析 |
| `Services/ClipboardMonitor.swift` | 文件 URL 序列化、copyToClipboard(fileURLs:) |
| `Services/RealClipboardService.swift` | 文件复制逻辑重写 |
| `Services/MockClipboardService.swift` | 添加 getDetailedStorageStats() |
| `ScopyTests/AppStateTests.swift` | Mock 服务协议实现 |
| `ScopyTests/Helpers/MockServices.swift` | Mock 服务协议实现 |

---

## 关键指标

### 功能测试
| 功能 | 测试方法 | 状态 |
|------|----------|------|
| 鼠标悬停不改变选中 | 手动验证 | ✅ |
| 键盘导航正常 | 手动验证 | ✅ |
| 版本号动态显示 | 设置窗口查看 | ✅ |
| 存储统计刷新 | 设置窗口操作 | ✅ |
| 文件复制粘贴 | Finder 粘贴验证 | ✅ |

### 测试状态
- **单元测试**: 48/48 passed (1 skipped)
- **构建状态**: Release ✅

---

## 当前状态

### 快速检查
```
功能状态:
  ✅ 鼠标悬停不影响选中
  ✅ 版本号动态显示
  ✅ 设置窗口三页 Tab
  ✅ 存储统计与刷新
  ✅ 文件 URL 正确复制
  ✅ 所有测试通过
```

---

## 遗留与后续

### 已知限制
1. **快捷键录制**: UI 已实现但功能尚未完整（需要 Carbon Event 集成）
2. **搜索模式**: 设置页可选择，但需要重启生效

### 后续工作
1. 完善快捷键自定义功能
2. 搜索模式实时切换
3. 更多设置选项（主题、行为等）

---

## 技术细节

### 文件 URL 序列化
```swift
// 序列化
static func serializeFileURLs(_ urls: [URL]) -> Data? {
    let paths = urls.map { $0.absoluteString }
    return try? JSONEncoder().encode(paths)
}

// 反序列化
static func deserializeFileURLs(_ data: Data) -> [URL]? {
    let paths = try? JSONDecoder().decode([String].self, from: data)
    return paths?.compactMap { URL(string: $0) }
}

// 写入剪贴板
func copyToClipboard(fileURLs: [URL]) {
    let pasteboard = NSPasteboard.general
    pasteboard.clearContents()
    pasteboard.writeObjects(fileURLs as [NSURL])
}
```

### 版本号获取
```swift
enum AppVersion {
    static var version: String {
        Bundle.main.infoDictionary?["CFBundleShortVersionString"] as? String ?? "Unknown"
    }
    static var build: String {
        Bundle.main.infoDictionary?["CFBundleVersion"] as? String ?? "1"
    }
}
```

---

**维护者**: Claude Code
**最后更新**: 2025-11-27
