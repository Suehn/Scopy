# v0.15.1 - Bug Fixes

**æ—¥æœŸ**: 2025-11-29

---

## ğŸ“Œ ä¸€é¡µçº¸æ€»ç»“

### What
ä¿®å¤ v0.15 UI ä¼˜åŒ–åçš„é—ç•™é—®é¢˜ï¼šæ–‡æœ¬é¢„è§ˆæ˜¾ç¤ºå¼‚å¸¸ã€å›¾ç‰‡å…ƒæ•°æ®æ ¼å¼ã€æ–‡æœ¬å…ƒæ•°æ®æœ«å°¾å­—ç¬¦æ˜¾ç¤ºã€‚

### Why
v0.15 å¼•å…¥çš„æ–‡æœ¬é¢„è§ˆåŠŸèƒ½å­˜åœ¨ SwiftUI çŠ¶æ€åŒæ­¥é—®é¢˜ï¼Œå¯¼è‡´é¢„è§ˆå¼¹çª—æ˜¾ç¤º ProgressView è€Œéå®é™…å†…å®¹ï¼›å›¾ç‰‡å’Œæ–‡æœ¬çš„å…ƒæ•°æ®æ˜¾ç¤ºæ ¼å¼éœ€è¦ä¼˜åŒ–ã€‚

### Result
- æ–‡æœ¬é¢„è§ˆæ­£å¸¸æ˜¾ç¤ºå†…å®¹ï¼ˆå‰100å­— + ... + å100å­—ï¼‰
- å›¾ç‰‡æœ‰ç¼©ç•¥å›¾æ—¶åªæ˜¾ç¤ºç¼©ç•¥å›¾å’Œå¤§å°ï¼Œå»é™¤ "Image" æ ‡é¢˜
- æ–‡æœ¬å…ƒæ•°æ®æ˜¾ç¤ºæœ€å15ä¸ªå­—ç¬¦ï¼ˆæ¢è¡Œç¬¦æ›¿æ¢ä¸ºç©ºæ ¼ï¼‰
- æ‰€æœ‰å†…å®¹ç±»å‹çš„å…ƒæ•°æ®ç»Ÿä¸€ä½¿ç”¨å°å­—ä½“(10pt)å’Œç¼©è¿›(8pt)

---

## ğŸ—ï¸ å®ç°è·¯çº¿

1. **Fix 1**: æ–‡æœ¬é¢„è§ˆå†…å®¹é—®é¢˜ (P0)
   - é—®é¢˜ï¼špopover æ˜¾ç¤ºæ—¶ `textPreviewContent` è¿˜æ˜¯ `nil`
   - ä¿®å¤ï¼šåŒæ­¥ç”Ÿæˆé¢„è§ˆå†…å®¹ï¼Œåœ¨ Task å¤–éƒ¨è®¾ç½®ï¼Œç¡®ä¿æ˜¾ç¤ºå‰å†…å®¹å·²å‡†å¤‡å¥½

2. **Fix 2**: å›¾ç‰‡æ˜¾ç¤ºä¼˜åŒ–
   - é—®é¢˜ï¼šæœ‰ç¼©ç•¥å›¾æ—¶ä»æ˜¾ç¤º "Image" æ ‡é¢˜ï¼Œå†—ä½™
   - ä¿®å¤ï¼š`case .image where showThumbnails` åªæ˜¾ç¤ºç¼©ç•¥å›¾å’Œå¤§å°

3. **Fix 3**: æ–‡æœ¬å…ƒæ•°æ®æœ«å°¾å­—ç¬¦
   - é—®é¢˜ï¼šæ˜¾ç¤º `......` è€Œéå®é™…å­—ç¬¦ï¼ˆæ¢è¡Œç¬¦å¯¼è‡´ï¼‰
   - ä¿®å¤ï¼šå°†æ¢è¡Œç¬¦æ›¿æ¢ä¸ºç©ºæ ¼åå†å–æœ€å15ä¸ªå­—ç¬¦

4. **Fix 4**: å…ƒæ•°æ®æ ·å¼ç»Ÿä¸€
   - é—®é¢˜ï¼šåªæœ‰ `default` case æœ‰å°å­—ä½“å’Œç¼©è¿›
   - ä¿®å¤ï¼šæ‰€æœ‰ case ç»Ÿä¸€ä½¿ç”¨ `.font(.system(size: 10))` å’Œ `.padding(.leading, ScopySpacing.md)`

---

## ğŸ“‚ æ ¸å¿ƒæ”¹åŠ¨

| æ–‡ä»¶ | æ”¹åŠ¨ |
|------|------|
| `Scopy/Views/HistoryListView.swift` | ä¿®å¤æ–‡æœ¬é¢„è§ˆã€å…ƒæ•°æ®æ ·å¼ã€å›¾ç‰‡æ˜¾ç¤º |
| `Scopy/Protocols/ClipboardServiceProtocol.swift` | å›¾ç‰‡ title æ”¹ä¸º "Image" |

### å…³é”®ä»£ç å˜æ›´

**æ–‡æœ¬é¢„è§ˆä¿®å¤** (`HistoryListView.swift`):
```swift
private func startTextPreviewTask() {
    hoverPreviewTask?.cancel()

    // Generate preview content synchronously FIRST
    let text = item.plainText
    let preview: String
    // ... generate preview ...

    // Set content immediately (synchronous, on main thread)
    self.textPreviewContent = preview

    hoverPreviewTask = Task {
        // Wait for preview delay, then show popover
        // Content already set, no race condition
    }
}
```

**æ–‡æœ¬å…ƒæ•°æ®** (`HistoryListView.swift`):
```swift
private var textMetadata: String {
    let text = item.plainText
    let charCount = text.count
    let lineCount = text.components(separatedBy: .newlines).count
    // æ˜¾ç¤ºæœ€å15ä¸ªå­—ç¬¦ï¼ˆå»é™¤æ¢è¡Œç¬¦ï¼Œæ›¿æ¢ä¸ºç©ºæ ¼ï¼‰
    let cleanText = text.replacingOccurrences(of: "\n", with: " ")
                        .replacingOccurrences(of: "\r", with: " ")
    let lastChars = cleanText.count <= 15 ? cleanText : "...\(String(cleanText.suffix(15)))"
    return "\(charCount)å­— Â· \(lineCount)è¡Œ Â· \(lastChars)"
}
```

**å›¾ç‰‡æ˜¾ç¤º** (`HistoryListView.swift`):
```swift
case .image where showThumbnails:
    // å›¾ç‰‡æœ‰ç¼©ç•¥å›¾æ—¶ï¼Œåªæ˜¾ç¤ºç¼©ç•¥å›¾å’Œå¤§å°ï¼Œä¸æ˜¾ç¤º "Image" æ ‡é¢˜
    HStack(spacing: ScopySpacing.md) {
        thumbnailView
        Text(metadataText)
            .font(.system(size: 10))
            .foregroundStyle(ScopyColors.mutedText)
            .lineLimit(1)
    }
```

---

## ğŸ¯ å…³é”®æŒ‡æ ‡

### åŠŸèƒ½éªŒè¯
- [x] æ–‡æœ¬é¢„è§ˆæ˜¾ç¤ºå†…å®¹ï¼ˆå‰100å­— + ... + å100å­—ï¼‰
- [x] å›¾ç‰‡æœ‰ç¼©ç•¥å›¾æ—¶åªæ˜¾ç¤ºç¼©ç•¥å›¾å’Œå¤§å°
- [x] æ–‡æœ¬å…ƒæ•°æ®æ˜¾ç¤ºæœ€å15ä¸ªå­—ç¬¦
- [x] æ‰€æœ‰å…ƒæ•°æ®ç»Ÿä¸€å°å­—ä½“å’Œç¼©è¿›
- [x] å›¾ç‰‡é¢„è§ˆä»æ­£å¸¸å·¥ä½œ

### æ„å»ºçŠ¶æ€
- æ„å»º: Release âœ…
- éƒ¨ç½²: /Applications/Scopy.app âœ…

---

## ğŸ“Š å½“å‰çŠ¶æ€

```
é¡¹ç›®çŠ¶æ€æ£€æŸ¥:
  âœ… ç‰ˆæœ¬: v0.15.1
  âœ… æ„å»º: Release æˆåŠŸ
  âœ… éƒ¨ç½²: /Applications/Scopy.app
  âœ… æ–‡æœ¬é¢„è§ˆ: æ­£å¸¸æ˜¾ç¤ºå†…å®¹
  âœ… å›¾ç‰‡æ˜¾ç¤º: ç¼©ç•¥å›¾ + å¤§å°
  âœ… å…ƒæ•°æ®æ ·å¼: ç»Ÿä¸€å°å­—ä½“å’Œç¼©è¿›
```

---

## ğŸ”® é—ç•™ä¸åç»­

### å·²å®Œæˆ
- v0.15 å­¤ç«‹æ–‡ä»¶æ¸…ç† (9.3GB â†’ 0)
- v0.15 Show in Finder ä¿®å¤
- v0.15 Footer ç®€åŒ–
- v0.15.1 æ–‡æœ¬é¢„è§ˆä¿®å¤
- v0.15.1 å…ƒæ•°æ®æ˜¾ç¤ºä¼˜åŒ–

### åç»­è®¡åˆ’
- v0.16: ç»§ç»­ UI ç¾åŒ–
- æ€§èƒ½ç›‘æ§æ”¶æ•›

---

**æœ€åæ›´æ–°**: 2025-11-29
**ç»´æŠ¤è€…**: Claude Code
