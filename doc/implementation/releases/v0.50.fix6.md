# v0.50.fix6

> çŠ¶æ€ï¼šâœ…
> è¯´æ˜ï¼šæ»šåŠ¨æ€§èƒ½ä¿®å¤ä¸æ€§èƒ½æµ‹è¯•è¡¥é½ã€‚

## ğŸ“Œ ä¸€é¡µçº¸æ€»ç»“ï¼ˆWhat / Why / Resultï¼‰

### What

- Perf/UIï¼šæ»šåŠ¨çŠ¶æ€æ”¹ä¸º start/end äº‹ä»¶é©±åŠ¨ï¼Œç§»é™¤é«˜é¢‘ onScroll è½®è¯¢ã€‚
- Perf/UIï¼šæ»šåŠ¨æœŸé—´å…³é—­è¡Œçº§ hover trackingï¼Œé¢„è§ˆæ¸…ç†ä»…åœ¨æœ‰çŠ¶æ€æ—¶è§¦å‘ï¼Œå‡å°‘æ— æ•ˆäº‹ä»¶ä¸çŠ¶æ€å†™å…¥ã€‚
- Perf/UIï¼šè¡Œçº§æ¸²æŸ“é™è½½ï¼ˆç›¸å¯¹æ—¶é—´æ–‡æœ¬ç¼“å­˜ + ä»…åœ¨æ‚¬åœ/é€‰ä¸­æ—¶ç»˜åˆ¶èƒŒæ™¯/è¾¹æ¡†ï¼‰ã€‚
- Perf/UIï¼šæ–‡æœ¬åˆ—è¡¨æ»šåŠ¨é™è½½ï¼ˆText metadata è®¡ç®—æ”¹ä¸ºå•æ¬¡æ‰«æ/ä½åˆ†é…ï¼›DisplayText ç¼“å­˜ key å»æ‹¼æ¥å­—ç¬¦ä¸²ï¼›é UI æµ‹è¯•æ¨¡å¼ä¸‹ç§»é™¤è¡Œçº§ accessibility identifier/valueï¼‰ã€‚
- Observablesï¼šHistoryViewModel ç®€åŒ–æ»šåŠ¨çŠ¶æ€æœºï¼Œä»…åœ¨å¼€å§‹/ç»“æŸæ—¶åˆ‡æ¢ã€‚
- Testsï¼šæ–°å¢æ»šåŠ¨çŠ¶æ€æ€§èƒ½æµ‹è¯• + æ»šåŠ¨é€šçŸ¥åˆå¹¶/è§£ç»‘å›è°ƒç”¨ä¾‹ã€‚

### Why

- æ»šåŠ¨æœŸé—´é«˜é¢‘é€šçŸ¥ + è½®è¯¢ä»»åŠ¡åœ¨ä¸»çº¿ç¨‹å½¢æˆé¢å¤–å‹åŠ›ï¼Œå¯¼è‡´ CPU å³°å€¼è¿‡é«˜ã€‚
- éœ€è¦ç”¨ç³»ç»Ÿçº§æ»šåŠ¨ç”Ÿå‘½å‘¨æœŸäº‹ä»¶æ›¿ä»£é‡‡æ ·/è½®è¯¢ï¼Œé™ä½è°ƒç”¨é¢‘ç‡ã€‚

### Result

- isScrolling ä»…åœ¨æ»šåŠ¨å¼€å§‹/ç»“æŸåˆ‡æ¢ï¼Œå‡å°‘æ— æ•ˆçŠ¶æ€æ›´æ–°ã€‚
- æ»šåŠ¨æ€§èƒ½æµ‹è¯•å¯é‡åŒ– scroll state æ›´æ–°æˆæœ¬ï¼Œé˜²å›é€€ã€‚
- è¡Œçº§ç»˜åˆ¶ä¸ç›¸å¯¹æ—¶é—´æ ¼å¼åŒ–æ¬¡æ•°ä¸‹é™ï¼Œæ»šåŠ¨æ—¶ CPU å³°å€¼è¿›ä¸€æ­¥æ”¶æ•›ã€‚
- çº¯æ–‡æœ¬é«˜é€Ÿæ»šåŠ¨æ—¶å‡å°‘æ¯è¡Œ metadata çš„é‡å¤åˆ†é…/æ‰«æä¸æ— æ„ä¹‰ accessibility å¼€é”€ï¼ŒCPU å³°å€¼è¿›ä¸€æ­¥ä¸‹é™ã€‚

---

## ğŸ“‚ æ ¸å¿ƒæ”¹åŠ¨

- `Scopy/Views/History/ListLiveScrollObserverView.swift`
  - ä½¿ç”¨ `willStartLiveScroll`/`didEndLiveScroll` äº‹ä»¶é©±åŠ¨æ»šåŠ¨çŠ¶æ€ã€‚
- `Scopy/Views/HistoryListView.swift`
  - æ¥å…¥æ»šåŠ¨ start/end å›è°ƒã€‚
- `Scopy/Observables/HistoryViewModel.swift`
  - ç§»é™¤æ»šåŠ¨è½®è¯¢é€»è¾‘ï¼Œæ–°å¢ `scrollDidStart/scrollDidEnd`ã€‚
- `Scopy/Observables/AppState.swift`
  - æš´éœ²æ»šåŠ¨ start/end å…¥å£ã€‚
- `Scopy/Views/History/HistoryItemView.swift`
  - æ»šåŠ¨æ—¶å…³é—­è¡Œçº§ hover è¿½è¸ªï¼›ç›¸å¯¹æ—¶é—´æ–‡æœ¬ç¼“å­˜ï¼›ä»…åœ¨æ‚¬åœ/é€‰ä¸­æ—¶ç»˜åˆ¶èƒŒæ™¯/è¾¹æ¡†ã€‚
- `Scopy/Views/History/SectionHeader.swift`
  - æ»šåŠ¨ä¸­ç¦ç”¨ header hover è¿½è¸ªï¼Œé¿å…æ— æ•ˆæ‚¬åœçŠ¶æ€æ›´æ–°ã€‚
- `Scopy/Presentation/ClipboardItemDisplayText.swift`
  - æ–‡æœ¬ metadata è®¡ç®—æ”¹ä¸ºå•æ¬¡æ‰«æ + O(1) tail æå–ï¼ˆä¿æŒå±•ç¤ºç»“æœä¸å˜ï¼‰ã€‚
- `Scopy/Domain/Utilities/TextMetrics.swift`
  - æ–°å¢ `displayWordUnitCountAndLineCount`ï¼Œé¿å…é‡å¤æ‰«æã€‚
- `Scopy/Views/HistoryListView.swift`
  - é UI æµ‹è¯•æ¨¡å¼ä¸‹ç§»é™¤è¡Œçº§ accessibility identifier/valueï¼Œé™ä½æ»šåŠ¨æœŸè¾…åŠ©åŠŸèƒ½æ ‘æ›´æ–°æˆæœ¬ã€‚
- `ScopyUISupport/IconService.swift`
  - icon/name cache countLimit æå‡ï¼Œå‡å°‘ç¼“å­˜æŠ–åŠ¨ã€‚
- `ScopyTests/ScrollPerformanceTests.swift`
  - æ–°å¢æ»šåŠ¨çŠ¶æ€æ€§èƒ½æµ‹è¯•ã€‚
- `ScopyTests/TextMetricsTests.swift`
  - æ–°å¢ lineCount è¯­ä¹‰å›å½’ç”¨ä¾‹ã€‚
- `ScopyTests/ClipboardItemDisplayTextTests.swift`
  - æ–°å¢ metadata å±•ç¤ºè¯­ä¹‰å›å½’ç”¨ä¾‹ï¼ˆå¯¹é½å†å²å®ç°ï¼‰ã€‚
- `Scopy.xcodeproj/project.pbxproj`
  - æ›´æ–°æµ‹è¯•æ–‡ä»¶ç´¢å¼•ã€‚

---

## ğŸ¯ æµ‹è¯•

- å•å…ƒæµ‹è¯•ï¼š
  - `xcodebuild test -project Scopy.xcodeproj -scheme Scopy -destination 'platform=macOS' -only-testing:ScopyTests/ScrollPerformanceTests`
  - âœ… Executed 3 tests, 0 failures
- è¯­ä¹‰å›å½’ï¼š
  - `xcodebuild test -project Scopy.xcodeproj -scheme Scopy -destination 'platform=macOS' -only-testing:ScopyTests/ClipboardItemDisplayTextTests -only-testing:ScopyTests/TextMetricsTests`
  - âœ… Passed

---

## ğŸ”® é—ç•™ä¸åç»­

- UI tests æœªå¤éªŒï¼ˆæœ¬æœº UI automation æœªå°±ç»ªæ—¶éœ€è·³è¿‡ï¼‰ã€‚
