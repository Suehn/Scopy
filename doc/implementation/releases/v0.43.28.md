# v0.43.28 â€” UX/Previewï¼šå¸¸è§ LaTeX æ–‡æ¡£ç»“æ„ï¼ˆitemize/enumerate/quote/paragraph/labelï¼‰è½¬ Markdown

**æ—¥æœŸ**ï¼š2025-12-16

## ğŸ“Œ ä¸€é¡µçº¸æ€»ç»“ï¼ˆWhat / Why / Resultï¼‰

### What

- **LaTeX æ–‡æ¡£ç»“æ„æ›´å¯è¯»**ï¼šåœ¨ hover é¢„è§ˆ Markdown æ¸²æŸ“é“¾è·¯ä¸­ï¼Œæ–°å¢å¯¹å¸¸è§ LaTeX â€œå†™è®ºæ–‡/ç¬”è®°â€ç»“æ„çš„è½»é‡è½¬æ¢ï¼š
  - `\\section/\\subsection/\\subsubsection`ï¼ˆå·²æ”¯æŒï¼‰+ æ–°å¢ `\\paragraph/\\subparagraph`
  - `\\begin{itemize}/\\item/\\end{itemize}` â†’ `- ...`
  - `\\begin{enumerate}/\\item/\\end{enumerate}` â†’ `1. ...`
  - `\\begin{quote}...\\end{quote}` â†’ `> ...`
  - `\\label{...}`ï¼šç§»é™¤ï¼ˆé¿å…é¢„è§ˆä¸­å‡ºç°â€œè®ºæ–‡æ’ç‰ˆå…ƒä¿¡æ¯â€å™ªå£°ï¼‰
- **å†…è”æ ¼å¼å‘½ä»¤è½¬ Markdown**ï¼š
  - `\\textbf{...}` â†’ `**...**`
  - `\\emph{...}` / `\\textit{...}` â†’ `*...*`
  - è¯¥æ­¥éª¤åœ¨ **math ç‰‡æ®µè¢« placeholder ä¿æŠ¤ä¹‹å** æ‰§è¡Œï¼Œé¿å…è¯¯æ”¹ KaTeX æ•°å­¦ç¯å¢ƒå†…éƒ¨çš„å‘½ä»¤ã€‚
- **æ¢è¡Œå…¼å®¹**ï¼šå°† PDF/Word å¸¸è§çš„ `U+2028/U+2029` è¡Œåˆ†éš”ç¬¦ä¸ CRLF ç»Ÿä¸€å½’ä¸€åŒ–ä¸º `\\n`ï¼Œæå‡å¤åˆ¶æ¥æºå¤æ‚æ—¶çš„ç¨³å®šæ€§ã€‚

### Why

- ç”¨æˆ·åé¦ˆï¼šè®ºæ–‡æ®µè½æ‹·è´æ–‡æœ¬å¸¸åŒ…å« `\\begin{itemize}`ã€`\\item`ã€`\\textbf`ã€`\\label` ç­‰ï¼Œå¯¼è‡´é¢„è§ˆå¯è¯»æ€§å·®ï¼ˆçœ‹èµ·æ¥åƒâ€œæºç â€è€Œä¸æ˜¯æ’ç‰ˆæ–‡æœ¬ï¼‰ã€‚
- ç›®æ ‡æ˜¯ä¿æŒâ€œè½»é‡ã€å®‰å…¨ã€å¯ç»´æŠ¤â€çš„å‰æä¸‹ï¼ŒæŠŠæœ€å¸¸è§çš„ LaTeX æ–‡æ¡£ç»“æ„æ˜ å°„åˆ° Markdown çš„ç­‰ä»·ç»“æ„ã€‚

### Result

- å¯¹â€œè®ºæ–‡/è®²ä¹‰å¼ LaTeX æ®µè½â€å¯è¯»æ€§æ˜¾è‘—æå‡ï¼šæ ‡é¢˜/åˆ—è¡¨/å¼•ç”¨/åŠ ç²—/å¼ºè°ƒåœ¨ hover é¢„è§ˆä¸­æ›´æ¥è¿‘æ—¥å¸¸é˜…è¯»å½¢æ€ã€‚
- æ¸²æŸ“é“¾è·¯ä»ä¿æŒå®‰å…¨ä¸é«˜æ€§èƒ½ï¼šè½¬æ¢åŸºäºè¡Œçº§çŠ¶æ€æœº + æœ‰ç•Œæ‰«æï¼Œä¸å¼•å…¥æ–°ä¾èµ–ï¼Œä¸è§¦å‘ç½‘ç»œã€‚

---

## ğŸ—ï¸ å®ç°è¦ç‚¹

1. `LaTeXDocumentNormalizer` æ‰©å±•ä¸ºè¡Œçº§è½»é‡è½¬æ¢å™¨ï¼šç»´æŠ¤ `itemize/enumerate/quote` çŠ¶æ€å¹¶è¾“å‡º Markdown ç­‰ä»·ç»“æ„ï¼›å‰”é™¤ `\\label{...}`ã€‚
2. `LaTeXInlineTextNormalizer` ä½œä¸ºç‹¬ç«‹æ­¥éª¤æ”¾åœ¨ `MathProtector` ä¹‹åæ‰§è¡Œï¼šåªå¤„ç†çº¯æ–‡æœ¬åŒºåŸŸï¼ˆmath å·²è¢« placeholder éš”ç¦»ï¼‰ï¼Œé¿å…ç ´åæ•°å­¦å…¬å¼ã€‚

---

## ğŸ“‚ ä¿®æ”¹æ–‡ä»¶

- `Scopy/Views/History/LaTeXDocumentNormalizer.swift`
- `Scopy/Views/History/LaTeXInlineTextNormalizer.swift`
- `Scopy/Views/History/MarkdownHTMLRenderer.swift`
- `ScopyTests/MarkdownMathRenderingTests.swift`
- `doc/implementation/README.md`
- `doc/implementation/CHANGELOG.md`
- `Scopy.xcodeproj/project.pbxproj`

---

## âœ… æµ‹è¯•ä¸æ„å»º

- å®šå‘å•æµ‹ï¼š`xcodebuild test -scheme Scopy -destination 'platform=macOS' -only-testing:ScopyTests/MarkdownMathRenderingTests -only-testing:ScopyTests/KaTeXRenderToStringTests` âœ…

