# v0.50.fix11

> çŠ¶æ€ï¼šâœ…
> è¯´æ˜ï¼šPerf/UIï¼ˆæ»šåŠ¨ï¼‰ï¼šå‡å°‘æ¯è¡Œå¸¸é©» NSView/çŠ¶æ€å†™å…¥ï¼Œé™ä½æ»šåŠ¨æœŸ CPU ä¸æ‰å¸§æ¯”ã€‚

## ğŸ“Œ ä¸€é¡µçº¸æ€»ç»“ï¼ˆWhat / Why / Resultï¼‰

### What

- Perf/UIï¼šä»…åœ¨é¢„è§ˆå¼€å¯æ—¶æ‰æ’å…¥ `ScrollWheelDismissMonitor`ï¼ˆé¿å…åˆ—è¡¨æ¯è¡Œå¸¸é©»ä¸€ä¸ª `NSViewRepresentable`ï¼‰ã€‚
- Perf/UIï¼š`relativeTimeText` åœ¨ `init` é¢„åˆå§‹åŒ–ï¼Œç§»é™¤ `.onAppear` é¦–æ¬¡å†™å…¥ `@State`ï¼ˆå‡å°‘è¡Œè¿›å…¥è§†çª—æ—¶çš„é¢å¤–æ›´æ–°å›åˆï¼‰ã€‚
- Choreï¼š`trace/` åŠ å…¥ `.gitignore`ï¼ˆé¿å… profiling äº§ç‰©è¯¯å…¥ç‰ˆæœ¬æ§åˆ¶ï¼‰ã€‚

### Why

- time profiler æ˜¾ç¤ºæ»šåŠ¨è·¯å¾„ä¸­å­˜åœ¨ `HistoryItemView.relativeTime.getter` ä¸ `ScrollWheelDismissMonitor.makeNSView(...)` ç›¸å…³å¼€é”€ï¼›
  åŒæ—¶ä¸»çº¿ç¨‹çƒ­ç‚¹ä»¥ `objc_msgSend`/malloc/AttributeGraph/SwiftUI ä¸ºä¸»ï¼Œè¯´æ˜éœ€è¦ä¼˜å…ˆå‡å°‘â€œæ¯è¡Œé¢å¤–è§†å›¾èŠ‚ç‚¹/çŠ¶æ€æ›´æ–°/æ¡¥æ¥ NSViewâ€è¿™ç±»ä¼šæ”¾å¤§æ¡†æ¶å¼€é”€çš„å› ç´ ã€‚

### Result

- æ»šåŠ¨ profileï¼ˆåŒæœºåŒåœºæ™¯ baseline-image-accessibilityï¼ŒDebugï¼Œå•æ¬¡å¯¹æ¯”ï¼‰ï¼š
  - v0.50.fix10ï¼šavg 20.61msï¼Œmax 508.33msï¼Œdrop_ratio 0.03767
  - v0.50.fix11ï¼šavg 18.12msï¼Œmax 208.33msï¼Œdrop_ratio 0.01807

> æ³¨ï¼šä»¥ä¸Šä¸º UI è‡ªåŠ¨åŒ–å•æ¬¡ run çš„å¯¹æ¯”ï¼Œä»å¯èƒ½å—ç³»ç»Ÿå™ªå£°å½±å“ï¼›ä½†æ–¹å‘ä¸ time profiler çƒ­ç‚¹ä¸€è‡´ã€‚

---

## ğŸ“‚ æ ¸å¿ƒæ”¹åŠ¨

- `.gitignore`
  - å¿½ç•¥ `trace/`ã€‚
- `Scopy/Views/History/HistoryItemView.swift`
  - `ScrollWheelDismissMonitor`ï¼šä»â€œæ¯è¡Œå¸¸é©»ä½† isActive å¯èƒ½ä¸º falseâ€æ”¹ä¸ºâ€œä»…é¢„è§ˆå¼€å¯æ—¶åˆ›å»ºâ€ã€‚
  - `relativeTimeText`ï¼š`State(initialValue:)` é¢„åˆå§‹åŒ–ï¼›ç§»é™¤ `.onAppear` çš„é¦–æ¬¡ `updateRelativeTimeText()`ã€‚

---

## âœ… æµ‹è¯•

- å•å…ƒæµ‹è¯•ï¼š
  - `xcodebuild test -scheme Scopy -destination 'platform=macOS' -only-testing:ScopyTests`
  - âœ… Executed 269 tests, 25 skipped, 0 failures

- UIï¼ˆæ»šåŠ¨ profile åŸºçº¿ï¼‰ï¼š
  - `SCOPY_RUN_PROFILE_UI_TESTS=1 xcodebuild test -scheme Scopy -destination 'platform=macOS' -only-testing:ScopyUITests/HistoryListUITests/testScrollProfileBaseline`
  - âœ… Passedï¼ˆåŒæ—¶äº§å‡º `/tmp/scopy_scroll_profile_baseline-image-accessibility_*.json`ï¼‰
