# v0.58

> çŠ¶æ€ï¼šâœ…
> è¯´æ˜ï¼šPerf/Searchï¼š6k+ å¤§æ–‡æœ¬å†å² fuzzy æé€Ÿ + æ¸è¿›å¼å…¨é‡æ ¡å‡†ï¼›Fix/UXï¼šæœç´¢æ—¶æ˜¾ç¤º Pinnedï¼›Toolingï¼šçœŸå® DB å¿«ç…§åŸºå‡†ã€‚

## ğŸ“Œ ä¸€é¡µçº¸æ€»ç»“ï¼ˆWhat / Why / Resultï¼‰

### What

- Perf/Searchï¼šå°† ASCII fuzzy å­åºåˆ—åŒ¹é…ä» `Character` éå†æ”¹ä¸º UTF16 å•æ¬¡æ‰«æï¼›é•¿æ–‡æœ¬è¯­æ–™ä¼˜å…ˆè¿”å› FTS é¢„ç­›é¦–å±ï¼Œå¹¶è‡ªåŠ¨è§¦å‘å…¨é‡æ ¡å‡†ï¼ˆä¸å‡å°‘æœç´¢èŒƒå›´ï¼‰ã€‚
- Perf/Searchï¼šçŸ­è¯ï¼ˆâ‰¤2ï¼‰fuzzy/fuzzy+ ä¸å†èµ° cache-limited prefilterï¼›æœªé¢„çƒ­å…¨é‡ç´¢å¼•æ—¶ç”¨ SQL substring å…¨é‡æ‰«æä¿éšœè¦†ç›–ï¼Œå·²å­˜åœ¨ç´¢å¼•æ—¶ä¼˜å…ˆèµ°å†…å­˜ç´¢å¼•è¿›ä¸€æ­¥æé€Ÿã€‚
- Fix/UXï¼šæœç´¢çŠ¶æ€ä¸‹å¦‚ pinned å‘½ä¸­ï¼ŒPinned åŒºåŸŸä»ä¼šå±•ç¤ºï¼ˆä¸å†ä»…ç©ºæœç´¢æ—¶å±•ç¤ºï¼‰ã€‚
- Perf/UIï¼šDTO è½¬æ¢é¿å…å¯¹æ¯æ¡ç»“æœé‡å¤è§¦ç›˜æ£€æŸ¥ç¼©ç•¥å›¾æ–‡ä»¶ï¼›å¯åŠ¨æ—¶å¼‚æ­¥å»ºç«‹ thumbnail cache æ–‡ä»¶åç´¢å¼•ï¼Œç¼©ç•¥å›¾ç”Ÿæˆåå¢é‡æ›´æ–°ç´¢å¼•ï¼Œé™ä½ç«¯åˆ°ç«¯æœç´¢/æ»šåŠ¨æŠ–åŠ¨ã€‚
- Tooling/Perfï¼šæ–°å¢çœŸå® DB å¿«ç…§è„šæœ¬ä¸åŸºå‡†å·¥å…·ï¼ˆ`make snapshot-perf-db` / `make bench-snapshot-search` / `ScopyBench`ï¼‰ã€‚
- DB/Migrationï¼šå¯é€‰åˆ›å»º `clipboard_fts_trigram`ï¼ˆSQLite æ”¯æŒ trigram tokenizer æ—¶å¯ç”¨ï¼Œä¸æ”¯æŒåˆ™è·³è¿‡ï¼Œä¿æŒæ•°æ®åº“å¯ç”¨ï¼‰ã€‚

### Why

- çœŸå®ä½¿ç”¨ä¸­å­˜åœ¨å¤§é‡é•¿æ–‡æœ¬ï¼ˆ6k+ æ¡ã€å•æ¡ä¸Šä¸‡å­—ç¬¦ï¼‰ï¼Œå…¨é‡ fuzzy åœ¨æç«¯æƒ…å†µä¸‹ä¼šå‡ºç°ç§’çº§å»¶è¿Ÿï¼Œä¸”â€œé¦–å±/å…¨é‡â€é˜¶æ®µç”¨æˆ·å®¹æ˜“è¯¯åˆ¤ä¸ºâ€œæ¼é¡¹/æ’åºä¸å‡†â€ã€‚
- ä¹‹å‰æ€§èƒ½æµ‹è¯•ä¸»è¦åŸºäºåˆæˆæ•°æ®ï¼Œæ— æ³•ä»£è¡¨ç”¨æˆ·çœŸå® 143MB å†å²åº“çš„è¡Œä¸ºï¼›éœ€è¦å¯é‡å¤ã€å¯å›å½’çš„çœŸå®æ€§èƒ½æµ‹è¯•é—­ç¯ã€‚

### Result

- çœŸå®æ€§èƒ½åŸºå‡†ï¼ˆrelease æ„å»ºï¼Œ`perf-db/clipboard.db` â‰ˆ 143MBï¼‰ï¼š
  - `fuzzyPlus + relevance + query=cm`ï¼šavg 41.10msï¼ŒP95 42.04ms
  - `fuzzyPlus + relevance + query=cmd`ï¼šavg 0.09msï¼ŒP95 0.12ms
  - `fuzzyPlus + relevance + forceFullFuzzy + query=cm`ï¼šavg 40.89msï¼ŒP95 41.35ms
  - `fuzzy + relevance + forceFullFuzzy + query=abc`ï¼šavg 2.40msï¼ŒP95 2.50ms
  - `fuzzy + relevance + forceFullFuzzy + query=cmd`ï¼šavg 2.69msï¼ŒP95 2.79ms

> æµ‹è¯•/åŸºå‡†ç¯å¢ƒï¼ˆæœ¬åœ°ï¼‰ï¼š`hw.model=Mac15,12`ï¼›macOS 26.2ï¼ˆ25C56ï¼‰ï¼›Xcode 16.3ï¼ˆ16E140ï¼‰ï¼›2026-01-11ã€‚

---

## ğŸ“‚ æ ¸å¿ƒæ”¹åŠ¨

- `Scopy/Infrastructure/Search/SearchEngineImpl.swift`ï¼šfuzzy UTF16 æ‰«æã€æ¸è¿›å¼é¢„ç­›+æ ¡å‡†ã€çŸ­è¯å…¨é‡è¦†ç›–ã€å¯é€‰ trigram FTS æŸ¥è¯¢è·¯å¾„ã€‚
- `Scopy/Application/ClipboardService.swift`ï¼šthumbnail cache æ–‡ä»¶åç´¢å¼•ã€DTO è½¬æ¢é™è½½ã€æœç´¢ç¼“å­˜å¤±æ•ˆæ›´ç²¾ç¡®ã€‚
- `Scopy/Observables/HistoryViewModel.swift`ï¼šæ¸è¿›å¼æœç´¢æç¤ºä¸è‡ªåŠ¨ refineï¼ˆforce full fuzzyï¼‰ã€‚
- `Scopy/Views/HistoryListView.swift`ï¼šæœç´¢çŠ¶æ€ä¸‹ä»å±•ç¤º pinned å‘½ä¸­ç»“æœã€‚
- `Scopy/Views/HeaderView.swift`ï¼šé¢„ç­›é˜¶æ®µæ˜¾ç¤ºâ€œæ­£åœ¨å…¨é‡æ ¡å‡†â€æç¤ºã€‚
- `scripts/snapshot-perf-db.sh` / `Tools/ScopyBench/main.swift` / `Makefile` / `Package.swift`ï¼šçœŸå®æ€§èƒ½æµ‹è¯•å·¥å…·é“¾ã€‚
- `Scopy/Infrastructure/Persistence/SQLiteMigrations.swift`ï¼šå¯é€‰ trigram FTS è¿ç§»ï¼ˆuser_version=4ï¼‰ã€‚

---

## âœ… æµ‹è¯•

- `make build`ï¼šâœ…ï¼ˆ2026-01-11ï¼‰
- `make test-unit`ï¼šExecuted 254 tests, 1 skipped, 0 failuresï¼ˆ2026-01-11ï¼‰
- `make test-strict`ï¼šExecuted 254 tests, 1 skipped, 0 failuresï¼ˆ2026-01-11ï¼‰
- `make bench-snapshot-search`ï¼šâœ…ï¼ˆè§ä¸Šæ–¹ Resultï¼‰

