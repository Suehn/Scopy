# v0.43.13 â€” Fix/UXï¼šHover é¢„è§ˆå¼¹çª—è´´åˆå†…å®¹å°ºå¯¸ï¼ˆå›¾ç‰‡/æ–‡æœ¬ï¼‰

**æ—¥æœŸ**ï¼š2025-12-15

## ğŸ“Œ ä¸€é¡µçº¸æ€»ç»“ï¼ˆWhat / Why / Resultï¼‰

- **What**ï¼š
  - å›¾ç‰‡ hover é¢„è§ˆå¼¹çª—ï¼šå†…å®¹åŒºåŸŸä¸å†å›ºå®šæ–¹å½¢ `frame`ï¼Œæ”¹ä¸ºæŒ‰å›¾ç‰‡åœ¨ `previewMax Ã— mainHeight` å†…ç­‰æ¯”ç¼©æ”¾åçš„å®é™…å°ºå¯¸è®¾ç½® `frame`ã€‚
  - æ–‡æœ¬ hover é¢„è§ˆå¼¹çª—ï¼šä¸å†å›ºå®š 400Ã—400ï¼Œé«˜åº¦æ”¹ä¸ºæŒ‰æ–‡æœ¬å®é™…å¸ƒå±€é«˜åº¦ï¼ˆä¸Šé™ `mainHeight`ï¼‰è‡ªé€‚åº”ï¼Œè¶…å‡ºåˆ™æ»šåŠ¨ã€‚
- **Why**ï¼šå›ºå®šæ–¹å½¢ `frame` + `.aspectRatio(.fit)` ä¼šå¯¼è‡´å¤§é‡ç©ºç™½è¾¹ï¼ˆå°¤å…¶æ˜¯å®½å±æˆªå›¾ï¼‰ï¼Œè§‚æ„Ÿåƒâ€œé¢„è§ˆæ¡†å¾ˆå¤§ä½†å›¾ç‰‡å¾ˆå°â€ã€‚
- **Result**ï¼šé¢„è§ˆå¼¹çª—ä¸å›¾ç‰‡æ˜¾ç¤ºåŒºåŸŸä¸€è‡´ï¼ˆæ— å¤§ç©ºéš™ï¼‰ï¼Œä»ä¿ç•™æœ€å¤§å°ºå¯¸é™åˆ¶ï¼Œé¿å…è¶…å¤§å›¾æ’‘çˆ†å±å¹•ã€‚

## ğŸ—ï¸ å®ç°è·¯çº¿

1. è¯»å– `CGImage/NSImage` åŸå§‹å°ºå¯¸
2. è®¡ç®—ç­‰æ¯”ç¼©æ”¾ç³»æ•° `scale = min(maxW/w, maxH/h)`
3. å°† popover æ ¹å®¹å™¨ `frame` è®¾ä¸ºç¼©æ”¾åçš„ `width/height`
4. æ–‡æœ¬é¢„è§ˆæŒ‰ `NSAttributedString.boundingRect` è®¡ç®—é«˜åº¦ï¼Œå°æ–‡æœ¬ç›´æ¥å±•ç¤ºï¼Œå¤§æ–‡æœ¬å¯ç”¨ `ScrollView`

## ğŸ“‚ æ ¸å¿ƒæ”¹åŠ¨

- `Scopy/Views/History/HistoryItemImagePreviewView.swift`ï¼šæŒ‰å›¾ç‰‡ç­‰æ¯”ç¼©æ”¾åçš„å°ºå¯¸è®¾ç½®å¼¹çª— `frame`
- `Scopy/Views/History/HistoryItemTextPreviewView.swift`ï¼šæ–‡æœ¬é¢„è§ˆé«˜åº¦è‡ªé€‚åº”ï¼ˆä¸Šé™ `mainHeight`ï¼Œè¶…å‡ºæ»šåŠ¨ï¼‰

## ğŸ¯ å…³é”®æŒ‡æ ‡

- `make test-unit`ï¼š**143 passed** (1 skipped)
- `make test-integration`ï¼š**12 passed**
- `make test-perf`ï¼š**17 passed** (6 skipped)
- `make test-tsan`ï¼š**143 passed** (1 skipped)
- `make test-strict`ï¼š**143 passed** (1 skipped)

**æ€§èƒ½åŸºçº¿**ï¼ˆåŒæœºåŒé…ç½®ï¼ŒDebugï¼Œ`make test-perf`ï¼›Low Power Mode disabledï¼›æœ¬ç‰ˆæœ¬æ— æ€§èƒ½ç›¸å…³æ”¹åŠ¨ï¼Œä»…å¤ç”¨ v0.43.12 å®æµ‹ï¼‰ï¼š

- Search 10k (fuzzyPlus) cold start â‰ˆ **113.67ms**ï¼›steady P95 â‰ˆ **48.44ms**ï¼ˆSamples: 50ï¼‰
- Disk 25k (fuzzyPlus) cold start â‰ˆ **712.36ms**ï¼›steady P95 â‰ˆ **44.92ms**ï¼ˆSamples: 60ï¼‰
- Service-path disk 10k (fuzzyPlus) cold start â‰ˆ **251.20ms**ï¼›steady P95 â‰ˆ **39.45ms**ï¼ˆSamples: 50ï¼‰

## ğŸ“Š å½“å‰çŠ¶æ€ï¼ˆå¿«é€Ÿæ£€æŸ¥ï¼‰

- Debug buildï¼šâœ…
- æµ‹è¯•ï¼šâœ…ï¼ˆunit/integration/perf/tsan/strictï¼‰

## ğŸ”® é—ç•™ä¸åç»­

- è‹¥ popover åœ¨æå°‘æ•°æƒ…å†µä¸‹ä»ä¸éšå†…å®¹å°ºå¯¸æ”¶ç¼©ï¼Œå¯è€ƒè™‘åœ¨ AppKit å±‚å¯¹ popover window è§¦å‘ä¸€æ¬¡ `invalidateIntrinsicContentSize`/`layoutSubtreeIfNeeded` çš„å…œåº•ã€‚
