# v0.43.15 — Dev/Release：版本统一由 git tag 驱动（停止 commit-count 自动版本）

**日期**：2025-12-15

## 📌 一页纸总结（What / Why / Result）

- **What**：
  - 发布版本号统一由 **git tag** 驱动（例如 `v0.43.14`）。
  - CI Release workflow 不再用 `0.18.{commit_count}` 自动生成版本，也不再直接 `git push` 到 main 更新 Cask。
  - 构建时注入 `MARKETING_VERSION` / `CURRENT_PROJECT_VERSION`，确保 About/版本展示一致。
- **Why**：commit count 版本号与实现文档版本线不一致，且 CI 自动 push 会造成远端版本/主分支状态混乱。
- **Result**：版本号口径统一（tag 即版本），发布流程可追溯且更安全（Cask 更新走 PR）。

## 🏗️ 实现路线

1. 提供统一版本解析脚本 `scripts/version.sh`（忽略历史遗留 `v0.18.*`）
2. 本地构建（Makefile / deploy.sh）统一注入 build settings
3. CI Release workflow 改为从 tag 构建，并将 Cask 更新改为 PR
4. 更新 `AGENTS.md` / `CLAUDE.md` / `DEPLOYMENT.md`，固化发布约定

## 📂 核心改动

- `scripts/version.sh`：从 git tag 解析版本并输出 xcodebuild 参数
- `Scopy/Info.plist`：版本字段改为引用 `$(MARKETING_VERSION)` / `$(CURRENT_PROJECT_VERSION)`
- `Makefile` / `deploy.sh`：构建与测试统一注入版本参数
- `.github/workflows/release.yml`：tag 驱动发布，Cask 更新走 PR（不再 push main）
- `AGENTS.md` / `CLAUDE.md` / `DEPLOYMENT.md`：写入发布规范

## 🎯 关键指标

- `make test-unit`：**147 passed** (1 skipped)

## 📊 当前状态（快速检查）

- Debug build：✅
- 测试：✅（unit）

## 🔮 遗留与后续

- 建议为 `v0.43.11` 起的版本提交补齐对应 tag（`v0.43.11`/`v0.43.12`/`v0.43.13`/`v0.43.14`），以便 `scripts/version.sh` 在本地默认解析到最新版本线。
