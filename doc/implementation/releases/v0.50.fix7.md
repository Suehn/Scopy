# v0.50.fix7

> 状态：✅
> 说明：滚动性能稳定性修复（DisplayText 预热）+ 测试补齐。

## 📌 一页纸总结（What / Why / Result）

### What

- Perf/UI：DisplayText title/metadata 在后台预热，滚动时优先命中缓存。
- Observables：HistoryViewModel 在 load/loadMore/search/事件更新时触发预热。
- Tests：新增滚动观察生命周期与 DisplayText 预热性能用例；运行全量 ScopyTests。

### Why

- title/metadata 依赖文本扫描（TextMetrics），当用户快速滚动进入新页时会在主线程集中计算。
- 通过预热把计算移出滚动路径，降低主线程峰值，不改变 UI/语义。

### Result

- 新加载批次在后台完成 title/metadata 计算，滚动时读取缓存。
- UI/功能不变；滚动路径减少主线程字符扫描。
- 单元测试通过（性能测试需显式启用 `RUN_PERF_TESTS=1`）。

---

## 📂 核心改动

- `Scopy/Presentation/ClipboardItemDisplayText.swift`
  - 增加预热入口与批量写缓存路径（不改变展示语义）。
- `Scopy/Observables/HistoryViewModel.swift`
  - load/loadMore/search/事件更新触发预热。
- `ScopyTests/ClipboardItemDisplayTextTests.swift`
  - 新增预热缓存回归测试。
- `ScopyTests/ScrollPerformanceTests.swift`
  - 新增滚动观察 reattach/end-without-start 与 DisplayText 预热性能测试。

---

## 🎯 关键指标

- Scroll state update（1000 samples）：min 0.00 μs, max 1.07 μs, mean 0.31 μs, median 0.00 μs, P95 1.07 μs, P99 1.07 μs, std dev 0.46 μs
- DisplayText metadata access（400 items × 4096 chars）：cold 324.58 ms, cached 204.92 μs
- 单元测试：Executed 269 tests, 25 skipped, 0 failures
- 性能测试：未运行（需 `RUN_PERF_TESTS=1`）

---

## 📊 当前状态

- Debug ✅
- UI tests：未复验
- Performance tests：未运行（`RUN_PERF_TESTS=1`）

---

## 🔮 遗留与后续

- 在相同环境下补跑 `RUN_PERF_TESTS=1` 性能矩阵，生成完整 profile 对比数据。
- 若大规模数据集（>20k）滚动仍出现抖动，可评估分段预热/分页预取策略（不改变 UI）。
