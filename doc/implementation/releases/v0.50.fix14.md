# v0.50.fix14

> çŠ¶æ€ï¼šâœ…
> è¯´æ˜ï¼šFix/Previewï¼šæ”¶å£ hover Markdown/LaTeX é¢„è§ˆåœ¨â€œå…³é—­ â†’ å¿«é€Ÿ re-hover åŒä¸€è¡Œâ€åœºæ™¯ä¸‹å¶å‘ä¸å†å¼¹å‡ºçš„ç«æ€ï¼Œå¹¶è¿›ä¸€æ­¥å¼ºåŒ–å¤ç”¨é“¾è·¯çš„ç¨³å®šæ€§ã€‚

## ğŸ“Œ ä¸€é¡µçº¸æ€»ç»“ï¼ˆWhat / Why / Resultï¼‰

### What

- Fix/Previewï¼špopover close å…œåº•ä¸å†åœ¨â€œä»å¤„äº hover/å³å°† reopenâ€çš„çª—å£æœŸè¯¯è§¦å‘æ¸…ç†ï¼Œé¿å… pending reopen è¢«å–æ¶ˆï¼ˆåŒä¸€è¡Œå¿«é€Ÿ re-hover æ›´ç¨³å®šï¼‰ã€‚
- Fix/Previewï¼š`PopoverWindowCloseObserver` ç›‘å¬çª—å£å…³é—­æ›´å¯é ï¼ˆ`viewDidMoveToWindow` ç»‘å®š + `viewWillMove(toWindow: nil)` å…œåº•ï¼‰ã€‚
- Perf/Previewï¼šç¼“å­˜ Markdown é¢„è§ˆ metricsï¼ˆsize/overflowï¼‰ï¼Œå¹¶å…è®¸å¼ºåˆ¶è§¦å‘å°ºå¯¸ä¸ŠæŠ¥ï¼Œå¤ç”¨åŒä¸€ HTML æ—¶ reopen æ›´ç¨³ã€‚

### Why

- macOS ä¸Š SwiftUI `.popover(isPresented:)` çš„ dismiss æ—¶åº/ç»‘å®šå›å†™å­˜åœ¨ä¸ç¨³å®šæƒ…å†µï¼›å åŠ  hover close é˜²æŠ–ä¸ reopen schedulingï¼Œå®¹æ˜“å‡ºç°â€œæ—§ close å›è°ƒæ¸…æ‰æ–°ä¸€è½® pendingâ€çš„ç«æ€ã€‚
- WKWebView å¤ç”¨åœºæ™¯ä¸‹ï¼ŒåŒä¸€ HTML å¯èƒ½ä¸ä¼šå†æ¬¡è§¦å‘ `didFinish`/å°ºå¯¸æ¶ˆæ¯ï¼Œéœ€è¦æ˜¾å¼ refresh æ‰èƒ½ç¡®ä¿ measurer/popover å†æ¬¡æ‹¿åˆ°ç¨³å®šå°ºå¯¸ã€‚

### Result

- hover A â†’ å…³é—­ â†’ å¿«é€Ÿå† hover Aï¼šé¢„è§ˆå¯å¯é å†æ¬¡å¼¹å‡ºï¼›WebKit churn æ›´ä½ï¼Œ`Web Content` è¿›ç¨‹æ•°é‡æ›´ç¨³å®šã€‚

---

## ğŸ“‚ æ ¸å¿ƒæ”¹åŠ¨

- `Scopy/Views/History/HistoryItemView.swift`
- `Scopy/Views/HistoryListView.swift`
- `Scopy/Views/History/MarkdownPreviewWebView.swift`
- `Scopy/Views/History/MarkdownPreviewCache.swift`
- `Scopy/Views/History/MarkdownHTMLRenderer.swift`

---

## âœ… æµ‹è¯•

- â¸ æœªè¿è¡Œï¼ˆæŒ‰éœ€å¯è·‘ï¼š`xcodebuild test -scheme Scopy -destination 'platform=macOS' -only-testing:ScopyTests`ï¼‰

