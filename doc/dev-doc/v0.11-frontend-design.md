# v0.11 前端美化设计文档（Draft）

> 目标：以 macOS 原生风格重塑历史剪贴板主界面与 Settings，高度可自定义、前后端彻底解耦，保持现有性能与安全基线（参考 `doc/dev-doc/v0.md`、`doc/frontend-separation-review.md`）。

## 一页纸

- What: 建立设计系统，重做主界面信息架构与视觉，重构 Settings（Sidebar 分页 + 全量可配置项），补充中英双语方案。
- Why: 现有 UI 信息密度高但层次弱、控件风格不统一、设置分组缺少扩展位；需要在不触碰后端的前提下实现原生质感与高定制度。
- Scope: 主界面（Header/列表/悬浮预览/Footer）、Settings 全页导航与项拆分、设计系统（颜色/字体/间距/图标）、双语文案与格式策略。
- Guardrails: 不改服务层/协议；保留虚拟列表与懒加载；所有新设置通过 DTO/协议交互；热键仍由 AppDelegate 回调入口；性能目标同 v0.md。

## 约束与设计原则

- 原生优先：NSVisualEffectView、系统字体 SF Pro、SF Symbols；遵循 macOS HIG（层次、留白、分组）。
- 解耦优先：前端仅使用 `AppState + ClipboardServiceProtocol` 数据；严禁视图直接访问文件/路径；热键操作仅走回调。
- 性能预算：首屏渲染 < 16ms；滚动 60fps；长列表继续用 LazyVStack+分页；图片预览异步、缩略图缓存沿用现有策略。
- 多语言：默认中文/英文双语，所有文案使用 `LocalizedStringKey`，时间/数字使用 `FormatStyle`，避免字符串拼接。

## 主界面设计改进

### 当前痛点（基于现有 UI 与日志）

- 选中态蓝色实底过重；鼠标悬停与键盘选中缺少层级区分。
- 列表项对齐不一致：App 图标/缩略图/文本/时间间距随内容变化。
- 时间文案中英混排（“刚刚/分钟前”）占位不均；Pin 图标颜色与主题不统一。
- Header 过滤/搜索区紧凑度不足；Footer 文案按钮化，但图标与快捷键信息未分层。
- 空态/加载态缺少视觉反馈，长列表缺少分段感知（Pinned vs Recent）。

### 视觉方向

- 背景：保持毛玻璃（menu material），外框圆角 10px，阴影 8px 柔光。
- 颜色 Token：主色用系统 accent，文本采用 Primary/Secondary/Tertiary；高亮态使用 `accentColor.opacity(0.12)` + 发光描边。
- 字体层级：Title 13-14pt medium，正文 12-13pt regular，元信息 10-11pt monospacedDigit()。
- 间距：4pt 网格，列表内左右 12pt，行内主副文案 6pt 间距。
- 图标：统一 SF Symbols（pin.fill、doc.text.image、photo、doc.fill、clock），App 图标 16px。

### 布局与组件（主界面）

- **Panel 外框**：统一内边距 8pt，背景毛玻璃+半透明描边；顶部/底部分隔线使用 `Divider().opacity(0.5)`.
- **Header**：左对齐 Title“Scopy”+版本点亮，右侧紧凑的 App/Type 过滤器（圆角 Capsule 按钮，选中用蓝点），搜索框改 26pt 高度，内含放大镜+清除按钮+搜索模式提示（小型 Tag 显示 Exact/Fuzzy/Regex）。
- **Pinned Section**：仅在无搜索时显示；带折叠箭头与计数（如 `Pinned · 3`）；默认展开；分隔线与 Recent 区隔。
- **HistoryItem 模板**（三栅格：左 16px 图标、中 1-2 行内容、右  timestamp + pin）：
  - 状态：默认浅背景；Hover 使用 `secondary` 淡灰；键盘选中使用 `accentColor.opacity(0.12)` + 1px 描边，文字改为 Primary；Pinned 加左侧细竖条 `accentColor.opacity(0.5)`。
  - 文本类型：主行截断到 1 行（支持高亮匹配片段），副行显示来源 App/大小（10pt、secondary）。
  - 图片类型：左 App 图标，右侧 40-60px 缩略图 + 文本描述 `Image · 1.2 MB`，保持行高一致。
  - 文件类型：左 App 图标，右侧 SF Symbol `doc.fill` + 文件名 + 扩展名/大小。
  - 时间戳：右对齐，紧凑格式（`2m / 3h / 1d / 11-28`，遵循 Locale）。
- **交互**：
  - Hover 150ms 防抖已保留；预览弹窗用 `popover`，加上加载骨架，延迟沿用设置。
  - 快捷操作：行尾悬停时显示轻量图标按钮（Pin/Copy/Delete），键盘仍用上下/回车/⌥⌫/⌘⌫。
  - Load more：触底提示“Scroll for more”保持，但使用 `progressViewStyle(.circular)` + 辅助说明。
- **空态/错误态**：空列表显示系统图标 `tray` + “No items yet / 暂无记录”，提供“Go to Settings”入口；加载失败用 `exclamationmark.triangle` + retry。
- **Footer**：
  - 信息区：`已加载/总数 · 空间占用 · 搜索模式`，使用等宽字体。
  - 操作区：图标按钮 + 文案（⌘⌫ 清空、⌘, 设置、⌘Q 退出），按钮 hover 时浅色填充；Load More 按钮仅在搜索分页时出现。

### 动效与手势

- 进入/退出：窗口淡入 + 缩放 0.98 → 1.0（200ms）。
- 选中切换：背景颜色过渡 120ms；Pin/删除采用轻量缩放。
- 悬浮预览：淡入 120ms，带阴影；光标移出即隐藏。

## Settings 界面信息架构（Sidebar 导航）

### 布局

- 使用 `NavigationSplitView`：左侧 Sidebar 240px，右侧内容滚动容器，窗口建议 760×540。
- 分组样式：GroupBox + Section 头/脚注，统一 12pt 字体与 4pt 行距。
- 顶部标题区：展示版本号与默认存储路径预览；底部操作条（Reset/Cancel/Save）固定。

### 分页与字段（结合 v0.md + 潜在用户需求）

- **General**：开机启动、菜单栏图标样式、是否显示 Dock 图标、界面语言（English/简体中文）、默认搜索模式、更新检查。
- **Shortcuts**：全局弹出热键、删除/Pin/清空快捷键、粘贴后自动关闭、自动纯文本粘贴、快速操作（复制即粘贴开关）。
- **Clipboard & Privacy**：最大条数、最大空间、保存图片/文件/RTF/HTML、忽略的应用列表、密码管理器忽略、自动清空剪贴板计时、去重开关及“重复更新时间戳”选项。
- **Appearance**：窗口宽度、默认可见行数、Pinned 区折叠开关、App 图标/时间戳显示开关、标题截断长度、预览行数、搜索匹配高亮开关、缩略图高度、悬浮预览延迟、深/浅模式跟随系统。
- **Storage & Cleanup**：大内容阈值、缩略图缓存上限、自动清理间隔、清理策略（按条数/时间/空间）、清理时是否保留 Pin、数据库位置展示/打开 Finder。
- **About & Support**：版本信息、特性列表、性能指标、反馈/开源链接。

### 中英双语支持

- 文案全部改为 key 化：`"settings.general.launchAtLogin"` 等，`Localizable.strings (Base/en, zh-Hans)`。
- 单位/时间：使用 `Date.RelativeFormatStyle`、`MeasurementFormatter` 自动适配 Locale，避免硬编码“分钟前/MB”。
- 图标+文本结合，减少翻译长度对布局影响；必要时为中文/英文提供不同行长断词。

## 设计系统落地方案

- 新增目录 `Scopy/Design/`，仅包含前端 Token 与组件，服务层零依赖：
  - `ScopyColors.swift`：语义色（Background/SecondaryBG/AccentFill/Border/Warning/Success/Hover/Selection）。
  - `ScopyTypography.swift`：字体层级（title13, body12, caption11, mono10）。
  - `ScopySpacing.swift`：4pt 基准（4/6/8/12/16/20）。
  - `ScopyIcons.swift`：统一使用的 SF Symbols 常量。
  - `ScopyComponents.swift`（可选）：Button 风格、Tag、GroupBox 标题模板。
- 应用方式：Header/HistoryItem/Footer/Settings 统一调用 Token；保证深浅模式可用并与 NSColor 系统色匹配。

## 信息流与协议适配

- 数据来源仍通过 `AppState` 绑定，所有新增设置项需：
  1) 添加到 `SettingsDTO` 与默认值；
  2) 通过 `ClipboardServiceProtocol.updateSettings/getSettings` 读写；
  3) 事件流 `.settingsChanged` 触发 UI reload（已存在）。
- UI 不直接访问磁盘或服务实现；图片预览、统计等仍走协议方法；热键更新仅通过 `applyHotKeyHandler/unregisterHotKeyHandler`。

## 实施阶段（建议）

- Phase 1：设计系统引入 + 视觉 Token 替换（不改布局，验证深浅模式）。
- Phase 2：主界面布局与交互重构（Header/HistoryItem/Footer，加入空态/错误态）。
- Phase 3：Settings Sidebar 化与分页重组，补齐设置项与描述文案。
- Phase 4：双语文案落地（Localizable.strings），时间/数字格式化适配。
- Phase 5：验证与测试（UI 快照/UITests 扩充、性能对比、手动热键日志检查 `/tmp/scopy_hotkey.log`）。

## 测试与验收

- UI：浅/深模式截图比对；窗口缩放、长文本截断、Hover/选中态对比；Pinned 折叠/展开。
- 功能：快捷键录制→应用、搜索模式切换、分页加载、图片预览、清空/删除/Pin 操作。
- 性能：50/100 项首屏渲染 < 16ms，滚动无掉帧；搜索/加载延迟维持 v0.md 指标；缩略图预览不会阻塞主线程。
- 国际化：切换系统语言后文本/日期/单位正确，布局无溢出。

## 参考

- Apple Human Interface Guidelines for macOS（导航、分组、留白、视觉效果）。
- Maccy/系统设置应用的 Sidebar 模式、GroupBox 分组样式。
- 现有性能与分层规范：`doc/dev-doc/v0.md`、`doc/frontend-separation-review.md`、`doc/review/frontend-separation-review-v0.10.md`。
