# v0.44.fix5 - Performance Profile

日期：2025-12-16

环境：
- `hw.model=Mac15,12`
- 内存：24GB
- macOS 15.7.2（24G325）
- Xcode 16.3（16E140）

## 结论（摘要）

- 本次改动聚焦 Search 后端稳定性与大库读取吞吐：FTS query 构造从“整段 phrase”收敛为“多词 AND + 特殊字符安全转义”，并开启 SQLite `mmap_size`。
- 性能基线未出现回退；补齐了“长文 exact”回归用例，确保万字级文本下的 FTS 路径持续可用。

## 指标

| 场景 | 指标 | 结果 |
|------|------|------|
| Disk 25k items（fuzzyPlus） | cold start | 710.20ms |
| Disk 25k items（fuzzyPlus） | P95 | 47.56ms（Samples: 60） |
| Long-doc exact（40 docs, ~15840 chars） | P95 | 0.23ms（Samples: 20） |

## 测试命令

- Disk 25k：`xcodebuild test -scheme Scopy -destination 'platform=macOS' -only-testing:ScopyTests/PerformanceTests/testDiskBackedSearchPerformance25k`
- Long-doc exact：`xcodebuild test -scheme Scopy -destination 'platform=macOS' -only-testing:ScopyTests/PerformanceTests/testExactSearchPerformanceLongDocuments`

## 备注

- 本 profile 作为 `v0.44.fix5` 的基线记录；如需精确对比上一版本，可在相同机器上分别 checkout `v0.44.fix4` 与 `v0.44.fix5` 后重复上述两条命令，并记录差值。

