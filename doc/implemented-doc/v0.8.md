# v0.8 - 图片缩略图与 UI 优化

## 📌 一页纸总结

**What**: 实现图片缩略图显示、悬浮预览、多文件显示修复、滚动条样式优化

**Why**:
- 图片类型只显示 "[Image: X KB]" 不直观
- 多文件复制只显示第一个文件名
- 滚动条背景与整体不统一

**Result**:
- 图片显示缩略图，悬浮 1 秒后显示原图预览
- 多文件显示 "文件名 + N more" 格式
- 滚动条滚动时才显示，背景统一

---

## 🏗️ 实现路线

### Fix 1: 多文件显示
1. 修改 `ClipboardItemDTO.title` 的 `.file` case
2. 过滤空行，计算文件数量
3. 显示 "文件名 + N more" 格式

### Fix 2: 滚动条样式
1. 在 ScrollView 添加 `.scrollIndicators(.automatic)`
2. 滚动时显示，静止时隐藏

### Fix 3: 图片缩略图功能
1. **SettingsDTO** 添加缩略图配置字段
   - `showImageThumbnails`: 是否显示缩略图
   - `thumbnailHeight`: 缩略图高度 (默认 40px)
   - `imagePreviewDelay`: 悬浮预览延迟 (默认 1.0 秒)

2. **StorageService** 添加缩略图缓存管理
   - `getThumbnailPath()`: 获取缩略图路径
   - `generateThumbnail()`: 生成并保存缩略图
   - `getOriginalImageData()`: 获取原图数据
   - `cleanupThumbnailCache()`: LRU 清理策略

3. **ClipboardItemDTO** 添加字段
   - `thumbnailPath`: 缩略图路径
   - `storageRef`: 外部存储路径（用于原图预览）

4. **HistoryItemView** 显示缩略图
   - 图片类型显示缩略图而非图标
   - 悬浮计时器 + Popover 显示原图预览
   - 原图宽度限制 500px

5. **SettingsView** 添加缩略图设置
   - Show Thumbnails 开关
   - Thumbnail Height 选择器
   - Preview Delay 选择器

---

## 📂 核心改动

| 文件 | 改动 |
|------|------|
| `Protocols/ClipboardServiceProtocol.swift` | SettingsDTO 添加缩略图字段，ClipboardItemDTO 添加 thumbnailPath/storageRef |
| `Services/StorageService.swift` | 缩略图生成、缓存、LRU 清理 |
| `Services/RealClipboardService.swift` | 图片保存时生成缩略图，toDTO 添加新字段 |
| `Views/HistoryListView.swift` | 缩略图显示、悬浮预览、滚动条样式 |
| `Views/SettingsView.swift` | 缩略图设置 UI |
| `Services/MockClipboardService.swift` | 适配新字段 |
| `ScopyTests/*.swift` | 适配新字段 |

---

## 🎯 关键指标

| 指标 | 结果 |
|------|------|
| 构建状态 | Debug ✅ |
| 测试状态 | 48/48 passed (1 skipped) |
| 缩略图生成 | 自动生成，LRU 缓存 |
| 预览延迟 | 可配置 0.5-2.0 秒 |

---

## 📊 当前状态

```
项目状态检查:
  ✅ 多文件显示: "文件名 + N more"
  ✅ 滚动条样式: 滚动时显示
  ✅ 图片缩略图: 可配置高度
  ✅ 悬浮预览: 可配置延迟
  ✅ 设置持久化: UserDefaults

功能状态:
  ✅ 缩略图缓存目录: ~/Library/Application Support/Scopy/thumbnails/
  ✅ LRU 清理策略: 50MB 限制
  ✅ 原图预览: 宽度限制 500px
```

---

## 🔮 遗留与后续

### v0.md 进度 Review

**已实现 ✅**
- [x] 前后端分离架构
- [x] 菜单栏图标 + 快捷键弹出
- [x] 搜索框 + 列表显示
- [x] 分级存储（SQLite + 外部文件）
- [x] 懒加载分页
- [x] 去重策略
- [x] FTS5 搜索
- [x] 三种搜索模式
- [x] Pin 功能
- [x] 设置窗口
- [x] **缩略图缓存 + LRU 管理** (v0.8 新增)

**未实现 ❌**
- [ ] App 过滤按钮 (v0.md 1.2)
- [ ] 来源 app 图标 / 时间显示 (v0.md 1.2)
- [ ] 按时间清理策略 (v0.md 2.1)

### 后续计划
1. App 过滤功能
2. 时间显示优化
3. 按时间清理策略

---

**最后更新**: 2025-11-27
**维护者**: Claude Code
