# v0.44.fix28

> çŠ¶æ€ï¼šâœ…

## ğŸ“Œ ä¸€é¡µçº¸æ€»ç»“ï¼ˆWhat / Why / Resultï¼‰

### What

- Feat/Previewï¼šåœ¨ Markdown/LaTeX hover é¢„è§ˆä¸­æ–°å¢â€œå¯¼å‡ºæ¸²æŸ“ç»“æœä¸ºå›¾ç‰‡â€æŒ‰é’®ï¼šä¸€é”®å°†**ç™½åº•é»‘å­—**çš„æ¸²æŸ“ç»“æœæŒ‰**ä¸é¢„è§ˆä¸€è‡´çš„åˆ†è¾¨ç‡/å¸ƒå±€**å¯¼å‡ºä¸º **PNG** åˆ°å‰ªè´´æ¿ã€‚
- Safetyï¼šå¯¼å‡ºä½¿ç”¨ WebView snapshotï¼Œä¸ä¾èµ–å¤–éƒ¨ç½‘ç»œèµ„æºï¼›å¯¼å‡ºæ ·å¼ä»…åœ¨ snapshot æœŸé—´ä¸´æ—¶ç”Ÿæ•ˆï¼Œç»“æŸåè‡ªåŠ¨æ¢å¤ï¼Œä¸å½±å“ç°æœ‰é¢„è§ˆä½“éªŒã€‚
- APIï¼šClipboardService æ–°å¢ `copyToClipboard(imagePNGData:)`ï¼Œç»Ÿä¸€èµ° `.png` å†™å…¥ pasteboardã€‚

### Why

- ç”¨æˆ·åœ¨é¢„è§ˆé‡Œçœ‹åˆ°çš„â€œæ¸²æŸ“ç»“æœâ€æ˜¯æœ€ç»ˆå¯è¯»å½¢æ€ï¼›å°†å…¶ä»¥å›¾ç‰‡å½¢å¼å¤åˆ¶ï¼Œå¯ç”¨äºé‚®ä»¶/æ–‡æ¡£/èŠå¤©å·¥å…·ç²˜è´´ï¼Œä¸”é¿å…æ·±è‰²æ¨¡å¼/é€æ˜èƒŒæ™¯å¯¼è‡´çš„å¯è¯»æ€§é—®é¢˜ã€‚

### Result

- hover é¢„è§ˆä¸­å¯ç›´æ¥å¤åˆ¶â€œç™½åº•é»‘å­—â€çš„æ¸²æŸ“ç»“æœ PNGï¼Œä¸æ”¹å˜ç°æœ‰æ¸²æŸ“ã€ç¼“å­˜ä¸æ»šåŠ¨æ¡è¡Œä¸ºã€‚
- PNG ç¼–ç åœ¨åå°çº¿ç¨‹å®Œæˆï¼Œé¿å…åœ¨ä¸»çº¿ç¨‹åšé‡è®¡ç®—ï¼Œé™ä½ UI å¡é¡¿é£é™©ã€‚

---

## ğŸ“‚ æ ¸å¿ƒæ”¹åŠ¨

- `Scopy/Views/History/HistoryItemTextPreviewView.swift`
  - Markdown é¢„è§ˆå³ä¸Šè§’å¢åŠ å¯¼å‡ºæŒ‰é’®ï¼ˆ`Preview.ExportImage`ï¼‰ï¼Œè°ƒç”¨ WebView controller snapshot å¹¶å†™å…¥å‰ªè´´æ¿ã€‚
- `Scopy/Views/History/MarkdownPreviewWebView.swift`
  - `MarkdownPreviewWebViewController.makeLightSnapshotPNGForClipboard()`ï¼šä¸´æ—¶åˆ‡æ¢å¯¼å‡ºæ¨¡å¼ â†’ `WKWebView.takeSnapshot` â†’ åå° PNG ç¼–ç ã€‚
- `Scopy/Views/History/MarkdownHTMLRenderer.swift`
  - å¢åŠ å¯¼å‡ºä¸“ç”¨ CSSï¼ˆ`scopy-export-light`ï¼‰ä¸ JS æ¡¥æ¥ï¼ˆ`window.__scopySetExportMode`ï¼‰ï¼Œç”¨äº snapshot æœŸé—´å¼ºåˆ¶ç™½åº•é»‘å­—å¹¶éšè—æ»šåŠ¨æ¡ã€‚
- `Scopy/Domain/Protocols/ClipboardServiceProtocol.swift`
  - æ–°å¢ `copyToClipboard(imagePNGData:)`ï¼Œä¾› UI å¯¼å‡ºåŠŸèƒ½å¤ç”¨ã€‚
- `Scopy/Application/ClipboardService.swift`
  - å®ç° `copyToClipboard(imagePNGData:)`ï¼Œç»Ÿä¸€é€šè¿‡ `ClipboardMonitor.copyToClipboard(data:type:.png)` å†™å…¥ã€‚
- `ScopyTests/ClipboardServiceCopyToClipboardTests.swift`
  - æ–°å¢ PNG å†™å…¥å‰ªè´´æ¿å›å½’æµ‹è¯•ã€‚

---

## ğŸ¯ æµ‹è¯•

- å•å…ƒæµ‹è¯•ï¼š`make test-unit`ï¼šExecuted 219 tests, 1 skipped, 0 failures
- UI æµ‹è¯•ï¼š`xcodebuild test -only-testing:ScopyUITests`ï¼šExecuted 26 tests, 4 skipped, 0 failures

