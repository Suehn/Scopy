# v0.44.fix22

> çŠ¶æ€ï¼šğŸŸ¡ï¼ˆå¾… tag / releaseï¼‰

## ğŸ“Œ ä¸€é¡µçº¸æ€»ç»“ï¼ˆWhat / Why / Resultï¼‰

### What

- Fix/Clipboard Monitorï¼šé‡‡æ · Timer æ”¹ä¸ºç»‘å®š RunLoop çš„ `.common` modesï¼Œé¿å…åœ¨ UI/menu tracking æ—¶æš‚åœé‡‡æ ·å¯¼è‡´æ¼è®°å½•ã€‚
- Settingsï¼šæ–°å¢â€œå‰ªè´´æ¿é‡‡æ ·é—´éš”â€å¯è°ƒï¼ˆ100msï½2sï¼Œæ­¥è¿› 100msï¼‰ï¼Œå¹¶æŒä¹…åŒ–ï¼›å˜æ›´åä¼šé‡å¯é‡‡æ ·å®šæ—¶å™¨ã€‚

### Why

- `Timer.scheduledTimer` é»˜è®¤ç»‘å®š RunLoop çš„ default modeã€‚åœ¨æ»šåŠ¨ï¼ˆtrackingï¼‰ã€èœå• tracking ç­‰ mode ä¸‹å¯èƒ½ä¸è°ƒåº¦ã€‚
- å¯¹å‰ªè´´æ¿è¿™ç§â€œå¿…é¡»æŒç»­ã€ä¸å¯æ¼â€çš„åå°é‡‡é›†æ¥è¯´ï¼Œè¿™ä¼šé€ æˆé‡‡æ ·æš‚åœ â†’ `changeCount` è·³å˜ â†’ åªè®°å½•æœ€åä¸€æ¬¡ â†’ ä¸­é—´å¤åˆ¶ä¸¢å¤±ï¼ˆP1-1ï¼‰ã€‚

### Result

- é‡‡æ · Timer åœ¨ `.common` modes ä¸‹æŒç»­è°ƒåº¦ï¼Œtracking åœºæ™¯æ›´å¯é ï¼Œé™ä½â€œå†å²æ¼æ¡â€çš„æ¦‚ç‡ã€‚
- ç”¨æˆ·å¯æŒ‰â€œå®æ—¶æ€§ vs è€—ç”µâ€æƒè¡¡è°ƒæ•´é‡‡æ ·é—´éš”ï¼ˆ100msï½2sï¼‰ã€‚

---

## ğŸ—ï¸ å®ç°è·¯çº¿

1. ClipboardMonitor çš„å®šæ—¶å™¨æ”¹ç”¨ `Timer(timeInterval:)` åˆ›å»ºï¼Œå† `RunLoop.main.add(timer, forMode: .common)` æ˜¾å¼åŠ å…¥ `.common` modesã€‚
2. Settings å¢åŠ  `clipboardPollingIntervalMs`ï¼ˆIntï¼Œ100ï½2000msï¼‰ï¼ŒSettingsStore encode/decode æ—¶åš clampã€‚
3. ClipboardService å¯åŠ¨ä¸ `updateSettings` æ—¶ï¼ˆæ— æ³¨å…¥ override æ—¶ï¼‰æŒ‰è®¾ç½®åº”ç”¨é‡‡æ ·é—´éš”ï¼Œå¿…è¦æ—¶é‡å¯é‡‡æ ·å®šæ—¶å™¨ã€‚
4. Settings UIï¼ˆClipboard é¡µï¼‰æ–°å¢æ»‘æ¡æ§åˆ¶é‡‡æ ·é—´éš”ï¼ˆ100msï½2sï¼Œstep 100msï¼‰ã€‚

---

## ğŸ“‚ æ ¸å¿ƒæ”¹åŠ¨

- `Scopy/Services/ClipboardMonitor.swift`
  - é‡‡æ · Timer åŠ å…¥ `.common` modesï¼Œé¿å… tracking æš‚åœï¼ˆP1-1ï¼‰ã€‚
- `Scopy/Domain/Models/SettingsDTO.swift` / `Scopy/Infrastructure/Settings/SettingsStore.swift`
  - æ–°å¢ `clipboardPollingIntervalMs` å¹¶æŒä¹…åŒ–ï¼ˆclamp 100ï½2000msï¼‰ã€‚
- `Scopy/Application/ClipboardService.swift`
  - å¯åŠ¨/è®¾ç½®æ›´æ–°æ—¶åº”ç”¨é‡‡æ ·é—´éš”ï¼ˆsettings é©±åŠ¨ï¼‰ã€‚
- `Scopy/Views/Settings/ClipboardSettingsPage.swift`
  - æ–°å¢â€œå‰ªè´´æ¿é‡‡æ ·é—´éš”â€æ»‘æ¡ï¼ˆ100msï½2sï¼Œstep 100msï¼‰ã€‚
- `ScopyTests/IntegrationTests.swift`
  - æ–°å¢ SettingsStore æŒä¹…åŒ–/è¾¹ç•Œå›å½’ï¼›æ–°å¢ 2000ms é‡‡æ ·é—´éš”ä¸‹æ•è·å»¶è¿Ÿè¡Œä¸ºæµ‹è¯•ã€‚

---

## ğŸ¯ å…³é”®æŒ‡æ ‡

- å•å…ƒæµ‹è¯•ï¼š`make test-unit`ï¼šExecuted 207 tests, 1 skipped, 0 failures

---

## ğŸ”® é—ç•™ä¸åç»­

- æ‰‹åŠ¨éªŒè¯å»ºè®®ï¼šåœ¨æ»šåŠ¨åˆ—è¡¨/æ‰“å¼€èœå• tracking çš„åŒæ—¶ 1 ç§’å†…å¿«é€Ÿå¤åˆ¶å¤šæ¬¡ä¸åŒæ–‡æœ¬ï¼Œç¡®è®¤å†å²æ¡ç›®å®Œæ•´ï¼ˆç”¨äºéªŒè¯ P1-1 åœºæ™¯çš„æ”¹å–„ï¼‰ã€‚

