# v0.44.fix4

## ğŸ“Œ ä¸€é¡µçº¸æ€»ç»“ï¼ˆWhat / Why / Resultï¼‰

### What

- Fix/Previewï¼šæ”¯æŒå¸¸è§ LaTeX `tabular` è¡¨æ ¼åœ¨ hover é¢„è§ˆä¸­æ­£ç¡®æ¸²æŸ“ï¼ˆè½¬ Markdown pipe tableï¼‰ï¼Œå¹¶ä¿®å¤ `\text{...}` ä¸­ä¸‹åˆ’çº¿ `_` å¼•å‘çš„ KaTeX æŠ¥é”™ï¼ˆè‡ªåŠ¨è½¬ä¹‰ä¸º `\_`ï¼‰ã€‚

### Why

- è®ºæ–‡/ç¬”è®°é‡Œå¤§é‡ä½¿ç”¨ `center + tabular + hline` æ¥æ’ç‰ˆç¬¦å·è¡¨ï¼›åŸæ ·è¾“å‡ºä¼šè¢«å½“ä½œæ™®é€šæ–‡æœ¬ï¼Œå¯¼è‡´å¯è¯»æ€§æå·®ã€‚
- KaTeX éµå¾ª LaTeX è§„åˆ™ï¼š`_` åœ¨ text æ¨¡å¼å¿…é¡»è½¬ä¹‰ï¼›ç°å®æ–‡æœ¬å¸¸è§ `\text{drop_last}` è¿™ç§æœªè½¬ä¹‰å†™æ³•ï¼Œä¼šç›´æ¥è§¦å‘ KaTeX errorï¼ˆæ•´æ®µå˜çº¢ï¼‰ã€‚

### Result

- `tabular` è¡¨æ ¼åœ¨é¢„è§ˆä¸­ä»¥ Markdown è¡¨æ ¼å±•ç¤ºï¼Œè¡¨æ ¼å†…çš„ `$...$` ä»å¯æ­£å¸¸æ¸²æŸ“ã€‚
- `\text{...}` å†…æœªè½¬ä¹‰ `_` è‡ªåŠ¨è½¬ä¸º `\_`ï¼ŒKaTeX ä¸å†æŠ¥é”™ï¼Œé¿å…â€œçº¢å­—é”™è¯¯å…¬å¼â€ã€‚

---

## ğŸ—ï¸ å®ç°è·¯çº¿

1. åœ¨ `LaTeXDocumentNormalizer` ä¸­è¯†åˆ«å¹¶æ”¶é›† `tabular` ç¯å¢ƒå†…å®¹ï¼Œè§£æ `&` å’Œ `\\` è¡Œåˆ†éš”ï¼Œè¾“å‡º Markdown pipe tableï¼Œå¹¶è·³è¿‡ `center` åŒ…è£¹ä¸ `hline`ã€‚
2. å½’ä¸€åŒ–æ°´å¹³åˆ†å‰²çº¿ï¼šå°† `\noindent\rule{...}{...}` / `\rule{...}{...}` è½¬ä¸º Markdown `---`ã€‚
3. åœ¨ math ä¿æŠ¤é˜¶æ®µå¯¹ `\text{...}` å†…å®¹åšæœ€å°å¿…è¦è½¬ä¹‰ï¼šå°†æœªè½¬ä¹‰çš„ `_` æ›¿æ¢ä¸º `\_`ï¼Œåªä½œç”¨äº text å‘½ä»¤å†…éƒ¨ï¼Œé¿å…å½±å“æ—¢æœ‰æ•°å­¦è¯­ä¹‰ã€‚
4. å¢åŠ å›å½’æµ‹è¯•ï¼ˆå­—ç¬¦ä¸²æ–­è¨€ + KaTeX renderToString çœŸæ¸²æŸ“éªŒè¯ï¼‰ã€‚

---

## ğŸ“‚ æ ¸å¿ƒæ”¹åŠ¨

- `Scopy/Views/History/LaTeXDocumentNormalizer.swift`ï¼š`tabular` â†’ Markdown tableï¼›`center` è·³è¿‡ï¼›`rule` â†’ `---`ã€‚
- `Scopy/Views/History/MathProtector.swift`ï¼š`\text{...}` å†… `_` è‡ªåŠ¨è½¬ä¹‰ä¸º `\_`ã€‚
- `ScopyTests/MarkdownMathRenderingTests.swift`ï¼šæ–°å¢ tabular/rule å›å½’ç”¨ä¾‹ã€‚
- `ScopyTests/KaTeXRenderToStringTests.swift`ï¼šæ–°å¢å« `drop_last` çš„çœŸå® KaTeX æ¸²æŸ“ç”¨ä¾‹ã€‚

---

## ğŸ¯ å…³é”®æŒ‡æ ‡

- **æµ‹è¯•**ï¼š`xcodebuild test -scheme Scopy -destination 'platform=macOS' -only-testing:ScopyTests`ï¼ˆExecuted 220 tests, 7 skipped, 0 failuresï¼‰
- **ç¯å¢ƒ**ï¼šApple M3 / 24GBï¼›macOS 15.7.2ï¼ˆ24G325ï¼‰ï¼›Xcode 16.3ï¼ˆ16E140ï¼‰

---

## ğŸ“Š å½“å‰çŠ¶æ€

- å•å…ƒæµ‹è¯•ï¼š`xcodebuild test -scheme Scopy -destination 'platform=macOS' -only-testing:ScopyTests` âœ…
- å…¼å®¹æ€§ï¼šä¸æ”¹å˜æ—¢æœ‰å…¬å¼/Markdown è¡Œä¸ºï¼ˆæ–°å¢è§„åˆ™ä»…å‘½ä¸­ `tabular`/`center`/`rule` ä¸ `\text{}` å†… `_`ï¼‰âœ…

---

## ğŸ”® é—ç•™ä¸åç»­

- `tabular` ä»…åš best-effortï¼ˆé¢å‘å¸¸è§ä¸¤åˆ—è¡¨æ ¼/ç¬¦å·è¡¨ï¼‰ï¼›è‹¥è¦æ”¯æŒå¤æ‚åˆ—æ ¼å¼ï¼ˆå¤šåˆ—åˆå¹¶ã€`multicolumn` ç­‰ï¼‰ï¼Œå¯ä»¥å†æ‰©å±•è§£æå™¨ï¼Œä½†éœ€è¦æ›´å¤šçœŸå®æ ·ä¾‹é©±åŠ¨ã€‚
