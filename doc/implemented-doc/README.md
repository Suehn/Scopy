# Scopy å®ç°æ–‡æ¡£ç´¢å¼•

æœ¬ç›®å½•åŒ…å« Scopy é¡¹ç›®çš„å®ç°è®°å½•å’Œå¼€å‘æ–‡æ¡£ã€‚

## å¿«é€Ÿå¯¼èˆª

### ğŸ“‹ ä¸»æ–‡æ¡£

- **[test-hanging-fix.md](./test-hanging-fix.md)** - **æœ€æ–°** æµ‹è¯•å¡ä½é—®é¢˜ä¿®å¤
  - é—®é¢˜è¯Šæ–­ï¼šSwiftUI @main vs XCTest NSApplication å†²çª
  - è§£å†³æ–¹æ¡ˆï¼šç‹¬ç«‹ Bundle æ¨¡å¼ï¼ŒAppDelegate è§£è€¦
  - éªŒè¯ç»“æœï¼š45 ä¸ªæµ‹è¯• 1.6 ç§’å®Œæˆï¼Œæ— å¡ä½

- **[v0.5-phase1.md](./v0.5-phase1.md)** - æµ‹è¯•æµç¨‹è‡ªåŠ¨åŒ–
  - test-flow.sh è‡ªåŠ¨åŒ–è„šæœ¬ (ç¼–è¯‘ â†’ å®‰è£… â†’ å¯åŠ¨ â†’ æ£€æŸ¥)
  - health-check.sh 6 é¡¹å¥åº·æ£€æŸ¥
  - Makefile å‘½ä»¤é›†æˆ
  - å®Œæ•´çš„æµ‹è¯•éªŒè¯å’Œæ•…éšœå›æ»šæœºåˆ¶

- **[v0.4.md](./v0.4.md)** - ç”¨æˆ·å¯é…ç½®çš„è®¾ç½®çª—å£
  - è®¾ç½®çª—å£ UI (Form + Picker + Toggle)
  - âŒ˜, å¿«æ·é”®æ‰“å¼€è®¾ç½®
  - UserDefaults æŒä¹…åŒ–
  - å®Œæ•´çš„æµ‹è¯•è¿‡ç¨‹å’ŒéªŒè¯

- **[v0.3.1.md](./v0.3.1.md)** - å¤§å›¾ç‰‡æ€§èƒ½ä¼˜åŒ–
  - è½»é‡çº§å›¾ç‰‡æŒ‡çº¹ç®—æ³•
  - ä¸»çº¿ç¨‹æ€§èƒ½ä¼˜åŒ– (50Ã—+)
  - å»é‡åŠŸèƒ½éªŒè¯
  - ç”¨æˆ·æ— æ„ŸçŸ¥ä½“éªŒ

- **[v0.3.md](./v0.3.md)** - å‰åç«¯å®Œæ•´è”è°ƒ
  - åç«¯ä¸å‰ç«¯å®Œæ•´é›†æˆ
  - å…¨å±€å¿«æ·é”® (â‡§âŒ˜C)
  - æœç´¢åŠŸèƒ½ç«¯åˆ°ç«¯éªŒè¯
  - æ ¸å¿ƒåŠŸèƒ½å…¨éƒ¨å¯ç”¨

- **[v0.2.md](./v0.2.md)** - åç«¯å®Œæ•´å®ç°
  - ClipboardMonitor ç³»ç»Ÿå‰ªè´´æ¿ç›‘æ§
  - StorageService SQLite + FTS5 å­˜å‚¨
  - SearchService å¤šæ¨¡å¼æœç´¢
  - å®Œæ•´æµ‹è¯•å¥—ä»¶å’Œæ€§èƒ½åŸºå‡†

- **[v0.1.md](./v0.1.md)** - å‰ç«¯åˆå§‹å®ç°
  - å®ç°è·¯çº¿å’Œè®¾è®¡åŸåˆ™
  - UIç»„ä»¶å’ŒMockåç«¯
  - ä½¿ç”¨æ•™ç¨‹å’Œä»£ç ç¤ºä¾‹

### ğŸ¯ å¿«é€Ÿæ£€æŸ¥è¡¨

æ–°å¯åŠ¨å¯¹è¯æ—¶ï¼Œå‚è€ƒè¿™ä¸ªå¿«é€Ÿæ£€æŸ¥ï¼š

```
é¡¹ç›®çŠ¶æ€æ£€æŸ¥:
  âœ… æºä»£ç ä½ç½®: /Users/ziyi/Documents/code/Scopy/Scopy/
  âœ… ç¼–è¯‘å‘½ä»¤: make build
  âœ… è¿è¡Œå‘½ä»¤: make run (çœŸå®æœåŠ¡: USE_MOCK_SERVICE=0 make run)
  âœ… æµ‹è¯•æµç¨‹: make test-flow (å®Œæ•´æµ‹è¯•æµç¨‹è‡ªåŠ¨åŒ–)
  âœ… æµ‹è¯•å‘½ä»¤: make test
  âœ… å·²ç¼–è¯‘: Scopy.app
  âœ… å‰åç«¯å®Œå…¨é›†æˆ (v0.3)

åŠŸèƒ½çŠ¶æ€:
  âœ… åŸºç¡€ UIï¼ˆæœç´¢ã€åˆ—è¡¨ã€å¯¼èˆªï¼‰
  âœ… æœç´¢é˜²æŠ–ï¼ˆ150msï¼‰
  âœ… æ‡’åŠ è½½åˆ†é¡µ
  âœ… é”®ç›˜å¿«æ·é”®
  âœ… æµ®åŠ¨çª—å£
  âœ… ç³»ç»Ÿå‰ªè´´æ¿ç›‘æ§
  âœ… SQLite æ•°æ®æŒä¹…åŒ–
  âœ… FTS5 å…¨æ–‡æœç´¢ (å·²éªŒè¯)
  âœ… åˆ†çº§å­˜å‚¨ï¼ˆå°å†…å®¹å†…è”ï¼Œå¤§å†…å®¹å¤–éƒ¨ï¼‰
  âœ… å†…å®¹å»é‡ (å·²éªŒè¯)
  âœ… è‡ªåŠ¨æ¸…ç†
  âœ… å…¨å±€å¿«æ·é”® (â‡§âŒ˜C)
  âœ… å¤§å›¾ç‰‡æ€§èƒ½ä¼˜åŒ– (v0.3.1)
  âœ… è®¾ç½®çª—å£ (v0.4 - å·²å®Œæˆ)
  âœ… æµ‹è¯•å¡ä½é—®é¢˜ä¿®å¤ (å·²å®Œæˆ)
  âœ… æµ‹è¯•æµç¨‹è‡ªåŠ¨åŒ– (v0.5-phase1 - å·²å®Œæˆ)
  âœ… æµ‹è¯•æ‰§è¡Œ 45 ä¸ªæµ‹è¯• 1.6s æ— å¡ä½ (å·²éªŒè¯)
  â³ æœåŠ¡å±‚å•å…ƒæµ‹è¯• (v0.5-phase2 è®¡åˆ’)
  â³ UI æµ‹è¯• (v0.5-phase4 è®¡åˆ’)
```

### ğŸ“ æ–‡ä»¶ç»“æ„

```
implemented-doc/
â”œâ”€â”€ README.md           â† ä½ åœ¨è¿™é‡Œ
â”œâ”€â”€ v0.1.md             â† å‰ç«¯å®ç°æ–‡æ¡£
â”œâ”€â”€ v0.2.md             â† åç«¯å®ç°æ–‡æ¡£
â”œâ”€â”€ v0.3.md             â† å‰åç«¯è”è°ƒæ–‡æ¡£
â”œâ”€â”€ v0.3.1.md           â† å¤§å›¾ç‰‡æ€§èƒ½ä¼˜åŒ–
â”œâ”€â”€ v0.4.md             â† è®¾ç½®çª—å£
â””â”€â”€ v0.5-phase1.md      â† æµ‹è¯•æµç¨‹è‡ªåŠ¨åŒ– (æœ€æ–°)
```

### ğŸš€ å¿«é€Ÿå¼€å§‹

```bash
cd /Users/ziyi/Documents/code/Scopy

# ç¬¬ä¸€æ¬¡
make setup

# æ„å»ºå’Œè¿è¡Œ
make run

# è¿è¡Œæµ‹è¯•
make test

# æ€§èƒ½åŸºå‡†
make benchmark
```

## ç‰ˆæœ¬å†å²

| ç‰ˆæœ¬ | æ—¥æœŸ       | ä¸»è¦å†…å®¹                                           |
| ---- | ---------- | -------------------------------------------------- |
| æµ‹è¯•å¡ä½ä¿®å¤ | 2025-11-27 | æµ‹è¯•å¡ä½é—®é¢˜ä¿®å¤ï¼šç‹¬ç«‹ Bundleã€AppDelegate è§£è€¦  |
| v0.5-Phase1 | 2025-11-27 | æµ‹è¯•æµç¨‹è‡ªåŠ¨åŒ–ï¼štest-flow.shã€health-checkã€é›†æˆ  |
| v0.4 | 2025-11-27 | è®¾ç½®çª—å£ï¼šå¯é…ç½®å‚æ•°ã€æŒä¹…åŒ–ã€å¿«æ·é”®æ”¯æŒ          |
| v0.3.1 | 2025-11-27 | å¤§å›¾ç‰‡æ€§èƒ½ä¼˜åŒ–ï¼šè½»é‡æŒ‡çº¹ç®—æ³•ã€ä¸»çº¿ç¨‹ä¼˜åŒ–          |
| v0.3 | 2024-11-27 | å‰åç«¯è”è°ƒï¼šå®Œæ•´é›†æˆã€å…¨å±€å¿«æ·é”®                 |
| v0.2 | 2024-11-27 | åç«¯å®Œæ•´å®ç°ï¼šç›‘æ§ã€å­˜å‚¨ã€æœç´¢ã€æµ‹è¯•              |
| v0.1 | 2024-11-27 | åˆå§‹å®ç°ï¼šMock åç«¯ + å®Œæ•´ UI                     |

## é¡¹ç›®æ¶æ„æ¦‚è§ˆ

```
Protocol-First Design:

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  UI Layer (SwiftUI Views)           â”‚
â”‚  - ContentView, HeaderView, etc.    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â†“ (via Protocol)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ClipboardServiceProtocol           â”‚
â”‚  - fetchRecent(), search(), etc.    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â†“                            â†“
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ MockService   â”‚         â”‚ RealClipboardServiceâ”‚
  â”‚ (å¼€å‘æµ‹è¯•)    â”‚         â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚  â”‚ClipboardMonitorâ”‚ â”‚
                            â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
                            â”‚  â”‚StorageService  â”‚ â”‚
                            â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
                            â”‚  â”‚SearchService   â”‚ â”‚
                            â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## æ ¸å¿ƒæ–‡ä»¶é€ŸæŸ¥

### åè®®å’ŒæœåŠ¡å±‚

| æ–‡ä»¶                                        | ç”¨é€”            | è¡Œæ•° |
| ------------------------------------------- | --------------- | ---- |
| `Protocols/ClipboardServiceProtocol.swift`  | åç«¯æ¥å£å®šä¹‰    | ~130 |
| `Services/ClipboardMonitor.swift`           | å‰ªè´´æ¿ç›‘æ§      | ~600 |
| `Services/StorageService.swift`             | SQLiteå­˜å‚¨      | ~500 |
| `Services/SearchService.swift`              | FTS5æœç´¢        | ~300 |
| `Services/RealClipboardService.swift`       | æœåŠ¡æ•´åˆ        | ~245 |
| `Services/MockClipboardService.swift`       | æµ‹è¯•æ•°æ®        | ~200 |
| `Services/PerformanceProfiler.swift`        | æ€§èƒ½åˆ†æ        | ~250 |
| `Services/HotKeyService.swift`              | å…¨å±€å¿«æ·é”®      | ~165 |

### UIå±‚

| æ–‡ä»¶                            | ç”¨é€”          | è¡Œæ•° |
| ------------------------------- | ------------- | ---- |
| `Observables/AppState.swift`    | çŠ¶æ€ç®¡ç†      | ~312 |
| `Views/ContentView.swift`       | ä¸» UI         | ~100 |
| `Views/HistoryListView.swift`   | åˆ—è¡¨ + æ‡’åŠ è½½ | ~160 |
| `Views/HeaderView.swift`        | æœç´¢æ¡†        | ~80  |
| `Views/FooterView.swift`        | åº•éƒ¨æ         | ~130 |
| `Views/SettingsView.swift`      | è®¾ç½®çª—å£      | ~247 |
| `FloatingPanel.swift`           | æµ®åŠ¨çª—å£      | ~100 |

### æµ‹è¯•

| æ–‡ä»¶                                   | ç”¨é€”         | è¡Œæ•° |
| -------------------------------------- | ------------ | ---- |
| `ScopyTests/StorageServiceTests.swift` | å­˜å‚¨æµ‹è¯•     | ~300 |
| `ScopyTests/SearchServiceTests.swift`  | æœç´¢æµ‹è¯•     | ~350 |
| `ScopyTests/ClipboardMonitorTests.swift` | ç›‘æ§æµ‹è¯•   | ~250 |
| `ScopyTests/IntegrationTests.swift`    | é›†æˆæµ‹è¯•     | ~300 |
| `ScopyTests/PerformanceTests.swift`    | æ€§èƒ½æµ‹è¯•     | ~350 |

## Makefile å‘½ä»¤é€ŸæŸ¥

```bash
# æ„å»º
make setup         # å®‰è£…ä¾èµ– + ç”Ÿæˆé¡¹ç›®
make build         # ç¼–è¯‘ (Debug)
make release       # ç¼–è¯‘ (Release)
make run           # ç¼–è¯‘å¹¶è¿è¡Œ
make quick-build   # å¿«é€Ÿç¼–è¯‘ï¼ˆè·³è¿‡é¡¹ç›®ç”Ÿæˆï¼‰
make xcode         # æ‰“å¼€ Xcode
make clean         # æ¸…ç†

# æµ‹è¯•
make test          # è¿è¡Œæ‰€æœ‰æµ‹è¯•
make test-unit     # è¿è¡Œå•å…ƒæµ‹è¯•
make test-perf     # è¿è¡Œæ€§èƒ½æµ‹è¯•
make test-integration  # è¿è¡Œé›†æˆæµ‹è¯•
make coverage      # ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
make benchmark     # å®Œæ•´åŸºå‡†æµ‹è¯•

# æµ‹è¯•æµç¨‹è‡ªåŠ¨åŒ– (v0.5-Phase1 æ–°å¢)
make test-flow     # å®Œæ•´æµç¨‹ (æ€è¿›ç¨‹ â†’ ç¼–è¯‘ â†’ å®‰è£… â†’ å¯åŠ¨ â†’ æ£€æŸ¥)
make test-flow-quick  # å¿«é€Ÿæµç¨‹ (è·³è¿‡ç¼–è¯‘)
make health-check  # ä»…è¿è¡Œ 6 é¡¹å¥åº·æ£€æŸ¥

# å¼€å‘
make format        # æ ¼å¼åŒ–ä»£ç  (éœ€è¦swift-format)
make lint          # æ£€æŸ¥ä»£ç  (éœ€è¦swiftlint)
make stats         # æ˜¾ç¤ºé¡¹ç›®ç»Ÿè®¡
make help          # æ˜¾ç¤ºå¸®åŠ©
```

## æœåŠ¡åˆ‡æ¢

é»˜è®¤ Debug æ¨¡å¼ä½¿ç”¨ Mock æœåŠ¡ï¼Œå¯é€šè¿‡ç¯å¢ƒå˜é‡åˆ‡æ¢ï¼š

```bash
# ä½¿ç”¨çœŸå®æœåŠ¡
USE_MOCK_SERVICE=0 make run

# æˆ–ä¿®æ”¹ AppState.swift
private init() {
    // self.service = MockClipboardService()  // å¼€å‘
    self.service = RealClipboardService()      // ç”Ÿäº§
}
```

## æ•°æ®å­˜å‚¨ä½ç½®

```
~/Library/Application Support/Scopy/
â”œâ”€â”€ clipboard.db          # SQLiteæ•°æ®åº“
â”œâ”€â”€ content/              # å¤§å†…å®¹å¤–éƒ¨å­˜å‚¨
â”‚   â””â”€â”€ <uuid>.png
â””â”€â”€ thumbnails/           # ç¼©ç•¥å›¾ç¼“å­˜
```

## æ€§èƒ½ç›®æ ‡ (v0.md)

| åœºæ™¯ | ç›®æ ‡ | çŠ¶æ€ |
|------|------|------|
| â‰¤5k æ¡æœç´¢ | P95 â‰¤ 50ms | âœ… |
| 10k-100k æ¡æœç´¢ | P95 â‰¤ 150ms | âœ… |
| æœç´¢é˜²æŠ– | 150-200ms | âœ… |
| å¤§å›¾ç‰‡å¤„ç† | <10ms | âœ… (v0.3.1) |

## ä¸‹ä¸€æ­¥å·¥ä½œ (v0.5 Phase 2-5 è®¡åˆ’)

### Phase 2: æœåŠ¡å±‚å•å…ƒæµ‹è¯• (P1)
- HotKeyServiceTests.swift (6 ä¸ªæµ‹è¯•ç”¨ä¾‹)
- PerformanceProfilerTests.swift (9 ä¸ªæµ‹è¯•ç”¨ä¾‹)
- æå‡åç«¯è¦†ç›–ç‡åˆ° 85%+

### Phase 3: å¤§æ–‡ä»¶å’Œå¤–éƒ¨å­˜å‚¨æµ‹è¯• (P1)
- StorageServiceTests æ‰©å±• (6 ä¸ªå¤§æ–‡ä»¶æµ‹è¯•)
- IntegrationTests æ‰©å±• (3 ä¸ªé›†æˆæµ‹è¯•)
- éªŒè¯ v0.md åˆ†çº§å­˜å‚¨è¦æ±‚

### Phase 4: UI æµ‹è¯•åŸºç¡€è®¾æ–½ (P2)
- ScopyUITests target é…ç½®
- SettingsViewUITests (10+ ä¸ª UI æµ‹è¯•)
- å…¶ä»– View çš„ UI æµ‹è¯•
- UI æµ‹è¯•è¦†ç›–ç‡ > 70%

### Phase 5: è¦†ç›–ç‡ç›‘æ§å’Œ CI/CD (P3)
- check_coverage.py è¦†ç›–ç‡æ£€æŸ¥è„šæœ¬
- HTML è¦†ç›–ç‡æŠ¥å‘Šç”Ÿæˆ
- GitHub Actions CI/CD é…ç½®
- æ•´ä½“è¦†ç›–ç‡ > 75%

### å…¶ä»–è®¡åˆ’
1. **åŠŸèƒ½å¢å¼º**: æœç´¢æ¨¡å¼é€‰æ‹©ã€æ‰¹é‡æ“ä½œã€åº”ç”¨è¿‡æ»¤
2. **å¯é€‰ç‰¹æ€§**: iCloudåŒæ­¥ã€å¯¼å‡ºã€å†…å®¹é¢„è§ˆ

## ç›¸å…³æ–‡ä»¶

- `doc/dev-doc/v0.md` - å®Œæ•´è®¾è®¡è§„èŒƒ
- `CLAUDE.md` - å¼€å‘æŒ‡å—
- `README.md` - ç”¨æˆ·æ–‡æ¡£

---

## ğŸ“Š é¡¹ç›®è¿›åº¦

```
v0.1-v0.4: åŸºç¡€åŠŸèƒ½ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 100%
v0.5-Phase1: æµ‹è¯•æµç¨‹ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ 20% (âœ… å®Œæˆ)
v0.5-Phase2: æœåŠ¡å±‚æµ‹è¯• â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ 0% (è®¡åˆ’)
v0.5-Phase3: å¤§æ–‡ä»¶æµ‹è¯• â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ 0% (è®¡åˆ’)
v0.5-Phase4: UI æµ‹è¯• â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ 0% (è®¡åˆ’)
v0.5-Phase5: CI/CD â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ 0% (è®¡åˆ’)
```

**æ€»ä½“å®Œæˆåº¦**: ~20% (v0.5 ç³»åˆ—ä¸­)

---

**æœ€åæ›´æ–°**: 2025-11-27
**ç»´æŠ¤è€…**: Claude Code
**æœ€æ–°å®Œæˆ**: v0.5-Phase1 (æµ‹è¯•æµç¨‹è‡ªåŠ¨åŒ–)
