# v0.44.fix27

> çŠ¶æ€ï¼šâœ…

## ğŸ“Œ ä¸€é¡µçº¸æ€»ç»“ï¼ˆWhat / Why / Resultï¼‰

### What

- Fix/Keyboardï¼šä¿®å¤ `âŒ¥âŒ«`ï¼ˆOption+Deleteï¼‰åœ¨æœç´¢æ¡†èšç„¦æ—¶ä¸è§¦å‘â€œåˆ é™¤é€‰ä¸­æ¡ç›®â€çš„é—®é¢˜ï¼Œç¡®ä¿å¿«æ·é”®å§‹ç»ˆç”Ÿæ•ˆã€‚
- Test/UITestsï¼šæ–°å¢ UI ç”¨ä¾‹è¦†ç›–â€œæœç´¢æ¡†èšç„¦ + `âŒ¥âŒ«` åˆ é™¤é€‰ä¸­é¡¹â€ï¼›å¹¶ä¸ºåˆ—è¡¨æ¡ç›®è¡¥å…… `accessibilityValue`ï¼ˆselected/unselectedï¼‰ç”¨äºç¨³å®šå®šä½å½“å‰é€‰ä¸­é¡¹ã€‚
- Test/UITestsï¼š`--uitesting` ä¸‹ä¸»çª—å£æå‡åˆ° `.floating` levelï¼Œé¿å…è¢«å…¶ä»–åº”ç”¨çª—å£é®æŒ¡å¯¼è‡´ hit-test å¤±è´¥ï¼ˆä¸å½±å“ç”Ÿäº§è¡Œä¸ºï¼‰ã€‚

### Why

- `âŒ¥âŒ«` åœ¨ macOS æ–‡æœ¬ç¼–è¾‘é‡Œå¸¸è¢« TextField æ¶ˆè´¹ä¸ºâ€œæŒ‰è¯åˆ é™¤â€ï¼Œå¯¼è‡´ SwiftUI çš„ `.onKeyPress` æ— æ³•ç¨³å®šæ”¶åˆ°è¯¥äº‹ä»¶ï¼›ä»ç”¨æˆ·è§†è§’å°±æ˜¯â€œå¿«æ·é”®åˆ é™¤ä¸ç”Ÿæ•ˆâ€ã€‚

### Result

- `âŒ¥âŒ«` åˆ é™¤é€‰ä¸­å†å²åœ¨æœç´¢æ¡†èšç„¦æ—¶ä¹Ÿå¯ç”¨ï¼Œè¡Œä¸ºä¸ Footer æç¤ºä¸€è‡´ã€‚
- UI æµ‹è¯•æ–°å¢å›å½’è¦†ç›–ï¼Œé¿å…åç»­å›é€€ã€‚

---

## ğŸ“‚ æ ¸å¿ƒæ”¹åŠ¨

- `Scopy/AppDelegate.swift`
  - åœ¨ `NSEvent.addLocalMonitorForEvents(.keyDown)` ä¸­æ‹¦æˆª `âŒ¥âŒ«` å¹¶è½¬å‘åˆ° `HistoryViewModel.deleteSelectedItem()`ï¼Œé¿å… TextField åƒæ‰äº‹ä»¶ã€‚
  - `--uitesting` ä¸‹æµ‹è¯•ä¸»çª—å£è®¾ä¸º `.floating` levelï¼Œé™ä½å¤–éƒ¨çª—å£é®æŒ¡å¯¼è‡´çš„ flakyã€‚
- `Scopy/Views/HistoryListView.swift`
  - ä¸º `History.Item.<uuid>` å¢åŠ  `accessibilityValue`ï¼ˆselected/unselectedï¼‰ï¼Œä¾¿äº UI ç”¨ä¾‹ç¨³å®šå®šä½å½“å‰é€‰ä¸­é¡¹ã€‚
- `ScopyUITests/KeyboardNavigationUITests.swift`
  - æ–°å¢ `testOptionDeleteDeletesSelectedItemEvenWhenSearchFocused` è¦†ç›–è¯¥å¿«æ·é”®å›å½’ã€‚

---

## ğŸ¯ æµ‹è¯•

- å•å…ƒæµ‹è¯•ï¼š`make test-unit`ï¼šExecuted 218 tests, 1 skipped, 0 failures
- UI æµ‹è¯•ï¼š`xcodebuild test -only-testing:ScopyUITests`ï¼šExecuted 26 tests, 4 skipped, 0 failures

