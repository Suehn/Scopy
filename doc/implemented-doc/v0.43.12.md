# v0.43.12 â€” Fix/UXï¼šæœç´¢ç»“æœæŒ‰æ—¶é—´æ’åºï¼ˆPinned ä¼˜å…ˆï¼‰+ å¤§ç»“æœé›†æ€§èƒ½ä¸å›é€€

**æ—¥æœŸ**ï¼š2025-12-15

## ğŸ“Œ ä¸€é¡µçº¸æ€»ç»“ï¼ˆWhat / Why / Resultï¼‰

- **What**ï¼š
  - æœç´¢ç»“æœç»Ÿä¸€æŒ‰ **Pinned ä¼˜å…ˆ + `lastUsedAt` å€’åº** æ’åºï¼ˆ`exact`/`fuzzy`/`fuzzyPlus`/çŸ­è¯ cache è·¯å¾„ä¸€è‡´ï¼‰ã€‚
  - `exact (FTS)` æŸ¥è¯¢æ”¹ä¸ºæ—¶é—´æ’åºï¼ˆç”± `idx_pinned` é©±åŠ¨ï¼‰ï¼Œè¡Œä¸ºä¸æœªè¿‡æ»¤åˆ—è¡¨ä¸€è‡´ã€‚
  - å¤§ç»“æœé›†ï¼ˆå€™é€‰â‰¥20kï¼‰é¢„å–/é¢„è¿‡æ»¤èµ° **time-first FTS prefilter**ï¼Œé¿å…æ’åºå˜åŒ–å¯¼è‡´æ€§èƒ½å›é€€ã€‚
- **Why**ï¼š
  - ä¹‹å‰æœç´¢æ’åºæ›´åç›¸å…³æ€§/FTS rankï¼Œç”¨æˆ·å¯»æ‰¾â€œæœ€è¿‘å¤åˆ¶/ä½¿ç”¨è¿‡çš„å†…å®¹â€æ—¶ä½“éªŒä¸ç¬¦åˆé¢„æœŸã€‚
  - ç›´æ¥æŠŠ FTS ç»“æœæŒ‰æ—¶é—´æ’åºå¯èƒ½å¼•å…¥ç£ç›˜æœç´¢æ€§èƒ½å›é€€ï¼Œéœ€è¦ç”¨ç´¢å¼•é©±åŠ¨çš„ prefilter ä¿ä½ P95ã€‚
- **Result**ï¼š
  - åˆ—è¡¨é¡ºåºæ›´ç¬¦åˆâ€œæœ€è¿‘ä½¿ç”¨â€çš„ç›´è§‰ï¼ŒPinned ä»ç¨³å®šç½®é¡¶ã€‚
  - æ€§èƒ½ï¼š`make test-perf` ä¸‹ç£ç›˜ 25k æœç´¢ P95 ç»´æŒåœ¨ä½åŒä½æ•°æ¯«ç§’çº§ï¼ˆè§ä¸‹æ–¹æŒ‡æ ‡ï¼‰ã€‚

## ğŸ—ï¸ å®ç°è·¯çº¿

1. `fuzzy/fuzzyPlus`ï¼šæ’åæ¯”è¾ƒå™¨æ”¹ä¸º `isPinned` â†’ `lastUsedAt` â†’ `score`ï¼Œåˆ†é¡µ/åŠ è½½æ›´å¤šæŒ‰åŒä¸€æ’åºæ¨è¿›ã€‚
2. `exact (FTS)`ï¼šç”¨ `clipboard_items INDEXED BY idx_pinned` + `rowid IN (fts MATCH)`ï¼Œç›´æ¥è¾“å‡º pinned/time æ’åºç»“æœã€‚
3. å¤§å€™é€‰é›†ï¼ˆâ‰¥20kï¼‰é¢„è¿‡æ»¤ï¼šæ„é€  FTS æŸ¥è¯¢ï¼ˆå¤šè¯ç”¨ `AND`ï¼‰ï¼Œç”¨ `idx_pinned` é©±åŠ¨åªå–æœ€è¿‘ä¸€æ®µå€™é€‰å¹¶åœ¨ `total=-1` çš„ prefilter è·¯å¾„ä¸Šâ€œå¤Ÿç”¨å³åœâ€ã€‚
4. æµ‹è¯•ï¼šè¡¥å…… SearchService æ’åºç”¨ä¾‹ï¼Œè¦†ç›– `exact` ä¸ `fuzzy` çš„æ—¶é—´æ’åºã€‚

## ğŸ“‚ æ ¸å¿ƒæ”¹åŠ¨

- `Scopy/Infrastructure/Search/SearchEngineImpl.swift`ï¼šç»Ÿä¸€æ—¶é—´æ’åºï¼›time-first FTS prefilterï¼›exact FTS time-order æŸ¥è¯¢ã€‚
- `ScopyTests/SearchServiceTests.swift`ï¼šæ–°å¢ `exact/fuzzy` æ—¶é—´æ’åºæ–­è¨€ã€‚

## ğŸ¯ å…³é”®æŒ‡æ ‡

- `make test-unit`ï¼š**143 passed** (1 skipped)
- `make test-integration`ï¼š**12 passed**
- `make test-perf`ï¼š**17 passed** (6 skipped)
- `make test-tsan`ï¼š**143 passed** (1 skipped)
- `make test-strict`ï¼š**143 passed** (1 skipped)

**æ€§èƒ½å®æµ‹**ï¼ˆåŒæœºåŒé…ç½®ï¼ŒDebugï¼Œ`make test-perf`ï¼›Low Power Mode disabledï¼‰ï¼š

- Search 10k (fuzzyPlus) cold start â‰ˆ **113.67ms**ï¼›steady P95 â‰ˆ **48.44ms**ï¼ˆSamples: 50ï¼‰
- Disk 25k (fuzzyPlus) cold start â‰ˆ **712.36ms**ï¼›steady P95 â‰ˆ **44.92ms**ï¼ˆSamples: 60ï¼‰
- Service-path disk 10k (fuzzyPlus) cold start â‰ˆ **251.20ms**ï¼›steady P95 â‰ˆ **39.45ms**ï¼ˆSamples: 50ï¼‰

