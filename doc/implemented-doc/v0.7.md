# v0.7 å®ç°æ–‡æ¡£ - UX ç²¾ç»†åŒ–ä¸æ€§èƒ½ç›‘æ§

**æ—¥æœŸ**: 2025-11-27
**çŠ¶æ€**: âœ… å·²å®Œæˆ
**æµ‹è¯•**: 48/48 passed (1 skipped)

---

## ğŸ“Œ ä¸€é¡µçº¸æ€»ç»“

### What
ä¿®å¤ v0.6 é—ç•™çš„ 5 ä¸ª UX é—®é¢˜ï¼Œå¹¶æ·»åŠ çœŸå®æ€§èƒ½æŒ‡æ ‡æ˜¾ç¤ºã€‚

### Why
- v0.6 é”™è¯¯ç§»é™¤äº†é¼ æ ‡æ‚¬åœé€‰ä¸­åŠŸèƒ½ï¼Œå¯¼è‡´ç”¨æˆ·æ— æ³•é€šè¿‡é¼ æ ‡å¿«é€Ÿé¢„è§ˆ
- æ–‡ä»¶å¤åˆ¶ä»ç„¶æ— æ³•åœ¨ Finder ä¸­ç²˜è´´
- åˆ é™¤æ“ä½œç¼ºå°‘å¿«æ·é”®æ”¯æŒ
- è®¾ç½®é¡µé¢ UI å­˜åœ¨å¤šå¤„ä¸ä¾¿
- About é¡µæ€§èƒ½æŒ‡æ ‡ä¸ºç¡¬ç¼–ç ï¼Œæ— å®é™…å‚è€ƒä»·å€¼

### Result
- âœ… é¼ æ ‡æ‚¬åœé€‰ä¸­æ¢å¤ï¼Œä½†ä¸è§¦å‘è‡ªåŠ¨æ»šåŠ¨
- âœ… æ–‡ä»¶å¤åˆ¶æ”¯æŒ Finder ç²˜è´´ (NSFilenamesPboardType)
- âœ… âŒ¥âŒ« å¿«æ·é”®åˆ é™¤å•æ¡è®°å½•
- âœ… âŒ˜âŒ« æ¸…ç©ºå†å²å¢åŠ ç¡®è®¤å¯¹è¯æ¡†
- âœ… çƒ­é”®å½•åˆ¶åŠŸèƒ½å®Œæ•´å®ç°
- âœ… Show in Finder æŒ‰é’®æ­£å¸¸å·¥ä½œ
- âœ… æœç´¢æ¨¡å¼è¯´æ˜ä¼˜åŒ–ä¸ºå•è¡Œ
- âœ… About é¡µæ˜¾ç¤ºçœŸå® P95 æ€§èƒ½æŒ‡æ ‡

---

## ğŸ—ï¸ å®ç°è·¯çº¿

### Phase 1: é¼ æ ‡é€‰ä¸­ä¸æ»šåŠ¨åˆ†ç¦» âœ…
1. åˆ›å»º `SelectionSource` æšä¸¾åŒºåˆ†é€‰ä¸­æ¥æº
2. æ¢å¤ `HistoryItemView` çš„ `.onHover` ä¿®é¥°ç¬¦
3. ä¿®æ”¹æ»šåŠ¨é€»è¾‘ï¼šä»…åœ¨ `lastSelectionSource == .keyboard` æ—¶æ»šåŠ¨

### Phase 2: ä¸­æ–‡æœ¬åœ°åŒ– â³
- è®¡åˆ’åœ¨åç»­ç‰ˆæœ¬å®ç°
- å½“å‰ä»…è°ƒæ•´äº† UI æ–‡æ¡ˆä¼˜åŒ–

### Phase 3: UI ä¼˜åŒ– âœ…
1. æœç´¢æ¨¡å¼ footer: 3 è¡Œ â†’ 1 è¡Œç´§å‡‘æ˜¾ç¤º
2. Show in Finder: ä½¿ç”¨ `activateFileViewerSelecting` API
3. çƒ­é”®å½•åˆ¶: å®Œæ•´å®ç° `onKeyPress` + Carbon modifiers è½¬æ¢

### Phase 4: æ–‡ä»¶å¤åˆ¶ä¿®å¤ âœ…
1. æ·»åŠ  `NSFilenamesPboardType` å…¼å®¹ Finder
2. åŒæ—¶è®¾ç½® NSURL å’Œæ–‡ä»¶è·¯å¾„åˆ—è¡¨

### Phase 5: åˆ é™¤å¿«æ·é”® âœ…
1. âŒ¥âŒ« åˆ é™¤å½“å‰é€‰ä¸­é¡¹
2. âŒ˜âŒ« æ¸…ç©ºå†å² + ç¡®è®¤å¯¹è¯æ¡†
3. å®ç° `deleteSelectedItem()` æ–¹æ³•

### Phase 6: æ€§èƒ½æŒ‡æ ‡çœŸå®æ˜¾ç¤º âœ…
1. åˆ›å»º `PerformanceMetrics` actor
2. è®°å½•æœç´¢å’ŒåŠ è½½å»¶è¿Ÿ
3. è®¡ç®— P95 å¹¶æ ¼å¼åŒ–æ˜¾ç¤º

---

## ğŸ“‚ æ ¸å¿ƒæ”¹åŠ¨

### æ–°å¢æ–‡ä»¶
| æ–‡ä»¶ | ç”¨é€” | è¡Œæ•° |
|------|------|------|
| `Services/PerformanceMetrics.swift` | æ€§èƒ½æŒ‡æ ‡æ”¶é›† actor | ~155 |

### ä¿®æ”¹æ–‡ä»¶
| æ–‡ä»¶ | æ”¹åŠ¨è¯´æ˜ |
|------|----------|
| `Observables/AppState.swift` | æ·»åŠ  `SelectionSource`ã€`lastSelectionSource`ã€`deleteSelectedItem()`ã€æ€§èƒ½è®°å½• |
| `Views/HistoryListView.swift` | æ¢å¤ `onHover`ã€æ·»åŠ  âŒ¥âŒ« å¿«æ·é”®ã€æ¡ä»¶æ»šåŠ¨ |
| `Views/FooterView.swift` | æ·»åŠ æ¸…ç©ºç¡®è®¤å¯¹è¯æ¡† |
| `Views/SettingsView.swift` | çƒ­é”®å½•åˆ¶ã€Show in Finderã€æœç´¢æ¨¡å¼ footer |
| `Services/ClipboardMonitor.swift` | `NSFilenamesPboardType` æ”¯æŒ |

---

## ğŸ¯ å…³é”®æŒ‡æ ‡

### æµ‹è¯•ç»“æœ
```
Test Suite 'All tests' passed
    Executed 48 tests, with 0 failures (0 unexpected) in 2.6s
    1 test skipped (testAsyncSearchPerformance)
```

### æ–°å¢åŠŸèƒ½éªŒè¯

| åŠŸèƒ½ | éªŒè¯æ–¹æ³• | çŠ¶æ€ |
|------|----------|------|
| é¼ æ ‡æ‚¬åœé€‰ä¸­ | ç§»åŠ¨é¼ æ ‡æ‚¬åœåˆ—è¡¨é¡¹ | âœ… |
| æ‚¬åœä¸æ»šåŠ¨ | æ‚¬åœä¸è§¦å‘ ScrollViewReader | âœ… |
| é”®ç›˜å¯¼èˆªæ»šåŠ¨ | â†‘â†“ é”®é€‰ä¸­æ—¶æ»šåŠ¨åˆ°å¯è§åŒºåŸŸ | âœ… |
| âŒ¥âŒ« åˆ é™¤ | æŒ‰å¿«æ·é”®åˆ é™¤å½“å‰é¡¹ | âœ… |
| âŒ˜âŒ« æ¸…ç©ºç¡®è®¤ | ç‚¹å‡» Clear å¼¹å‡ºç¡®è®¤å¯¹è¯æ¡† | âœ… |
| æ–‡ä»¶å¤åˆ¶ | å¤åˆ¶æ–‡ä»¶ååœ¨ Finder ç²˜è´´ | âœ… |
| çƒ­é”®å½•åˆ¶ | ç‚¹å‡»å½•åˆ¶æŒ‰é’®åæŒ‰é”®ç»„åˆ | âœ… |
| Show in Finder | ç‚¹å‡»æŒ‰é’®åœ¨ Finder ä¸­æ˜¾ç¤º | âœ… |
| æ€§èƒ½æŒ‡æ ‡ | About é¡µæ˜¾ç¤º P95 å€¼å’Œæ ·æœ¬æ•° | âœ… |

### æ€§èƒ½æŒ‡æ ‡ (å®æµ‹)

About é¡µé¢ç°åœ¨æ˜¾ç¤ºçœŸå®æ€§èƒ½æ•°æ®ï¼š
- **Search P95**: åŠ¨æ€æ˜¾ç¤ºï¼Œæ ¼å¼å¦‚ `2.5 ms (10 samples)`
- **Load P95**: åŠ¨æ€æ˜¾ç¤ºï¼Œæ ¼å¼å¦‚ `5.1 ms (5 samples)`
- æ— æ ·æœ¬æ—¶æ˜¾ç¤º `N/A`

---

## ğŸ“Š å½“å‰çŠ¶æ€

```
å¿«é€Ÿæ£€æŸ¥:
  âœ… 48/48 æµ‹è¯•é€šè¿‡
  âœ… Release æ„å»ºæˆåŠŸ
  âœ… é¼ æ ‡æ‚¬åœé€‰ä¸­ (ä¸æ»šåŠ¨)
  âœ… é”®ç›˜å¯¼èˆªæ»šåŠ¨
  âœ… âŒ¥âŒ« åˆ é™¤å¿«æ·é”®
  âœ… âŒ˜âŒ« æ¸…ç©ºç¡®è®¤
  âœ… æ–‡ä»¶å¤åˆ¶ Finder å…¼å®¹
  âœ… çƒ­é”®å½•åˆ¶åŠŸèƒ½
  âœ… Show in Finder
  âœ… çœŸå®æ€§èƒ½æŒ‡æ ‡
```

---

## ğŸ”® é—ç•™ä¸åç»­

### v0.7 é—ç•™
- [ ] ä¸­æ–‡æœ¬åœ°åŒ– (Phase 2 æœªå®ç°)
- [ ] çƒ­é”®å½•åˆ¶åéœ€è¦å®é™…åº”ç”¨åˆ° HotKeyService

### ä¸‹ä¸€æ­¥å»ºè®®
1. **v0.7.1**: ä¸­æ–‡æœ¬åœ°åŒ–å®Œæ•´å®ç°
2. **v0.7.2**: çƒ­é”®å½•åˆ¶ä¸ HotKeyService é›†æˆ
3. **v0.8**: æ‰¹é‡æ“ä½œã€åº”ç”¨è¿‡æ»¤

---

## ğŸ“ æŠ€æœ¯ç¬”è®°

### 1. SelectionSource è®¾è®¡
```swift
enum SelectionSource {
    case keyboard   // é”®ç›˜å¯¼èˆªï¼šåº”è¯¥æ»šåŠ¨åˆ°é€‰ä¸­é¡¹
    case mouse      // é¼ æ ‡æ‚¬åœï¼šä¸åº”æ»šåŠ¨
    case programmatic // ç¨‹åºè®¾ç½®ï¼šä¸æ»šåŠ¨
}
```

### 2. Finder æ–‡ä»¶ç²˜è´´å…¼å®¹
```swift
// å¿…é¡»åŒæ—¶è®¾ç½®ä¸¤ç§æ ¼å¼
pasteboard.writeObjects(fileURLs as [NSURL])
pasteboard.setPropertyList(paths, forType: NSPasteboard.PasteboardType("NSFilenamesPboardType"))
```

### 3. æ€§èƒ½æŒ‡æ ‡æ”¶é›†
```swift
actor PerformanceMetrics {
    private var searchLatencies: [Double] = []

    func recordSearchLatency(_ ms: Double) {
        searchLatencies.append(ms)
        if searchLatencies.count > maxSamples {
            searchLatencies.removeFirst()
        }
    }

    var searchP95: Double {
        let sorted = searchLatencies.sorted()
        let index = Int(Double(sorted.count) * 0.95)
        return sorted[min(index, sorted.count - 1)]
    }
}
```

### 4. SwiftUI onKeyPress æ­£ç¡®ç”¨æ³•
```swift
// âŒ é”™è¯¯: ä¸å­˜åœ¨è¿™ä¸ª API
.onKeyPress(.delete, modifiers: .option) { ... }

// âœ… æ­£ç¡®: ä½¿ç”¨é—­åŒ…æ£€æŸ¥ä¿®é¥°é”®
.onKeyPress { keyPress in
    if keyPress.key == .delete && keyPress.modifiers.contains(.option) {
        // handle delete
        return .handled
    }
    return .ignored
}
```

---

**å®Œæˆæ—¶é—´**: 2025-11-27
**ç»´æŠ¤è€…**: Claude Code
