# v0.43.35（Preview：移除最小宽高限制，完全动态贴合）

日期：2025-12-16

## 背景

在 hover 预览中，“最小宽高”会在单行短文本与矮图场景带来明显空白；用户期望完全按内容动态贴合，不做额外的最小尺寸钳制。

## 变更

- **移除最小宽高钳制**：
  - 文本预览：popover 的 `width/height` 不再使用 `minWidth/minHeight`；仅对 `maxWidth/maxHeight` 做上限约束。
  - 图片预览：不再对图片高度做最小值钳制，矮图按真实比例缩放后的高度展示。
- **单行宽度测量保持精确**：单行仍使用 `NSString.size(withAttributes:)` 进行宽度测量，避免因为 TextKit 行 fragment 宽度导致无法收缩。
- **回归测试同步**：更新 `HoverPreviewTextSizingTests`，不再假定存在最小宽度。

## 测试

- Release 构建：
  - `xcodebuild build -scheme Scopy -configuration Release -destination 'platform=macOS'`
- 定向单测：
  - `xcodebuild test -scheme Scopy -destination 'platform=macOS' -only-testing:ScopyTests/HoverPreviewTextSizingTests -only-testing:ScopyTests/MarkdownMathRenderingTests -only-testing:ScopyTests/KaTeXRenderToStringTests`

## 修改文件

- `Scopy/Views/History/HoverPreviewTextSizing.swift`
- `Scopy/Views/History/HistoryItemTextPreviewView.swift`
- `Scopy/Views/History/HistoryItemImagePreviewView.swift`
- `ScopyTests/HoverPreviewTextSizingTests.swift`
- `doc/implemented-doc/README.md`
- `doc/implemented-doc/CHANGELOG.md`

