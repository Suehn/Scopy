# v0.43.24 â€” Fix/Previewï¼šLaTeX ç¯å¢ƒå…¬å¼æ¸²æŸ“æ›´å…¼å®¹ + é¢„è§ˆè„šæœ¬æ³¨å…¥é˜²æŠ¤

**æ—¥æœŸ**ï¼š2025-12-16

## ğŸ“Œ ä¸€é¡µçº¸æ€»ç»“ï¼ˆWhat / Why / Resultï¼‰

### What

- **ç¯å¢ƒå…¬å¼ç›´æ¥è¯†åˆ«æ¸²æŸ“**ï¼š`renderMathInElement` å¢åŠ  `\\begin{equation}/\\end{equation}` ç­‰ LaTeX ç¯å¢ƒ delimiterï¼ˆå« `*` å˜ä½“ï¼‰ï¼Œä¸å†æŠŠç¯å¢ƒå—å¼ºåˆ¶æ”¹å†™æˆ `$$...$$`ã€‚
- **å…¼å®¹æ€§å¢å¼º**ï¼šä¿ç•™åŸå§‹ç¯å¢ƒå†…å®¹ä¸ `\\tag{...}` ç­‰å†™æ³•ï¼Œç”± KaTeX æŒ‰ç¯å¢ƒè¯­ä¹‰è§£æï¼Œå‡å°‘â€œè®ºæ–‡/PDF é£æ ¼ç‰‡æ®µâ€æ¸²æŸ“åå·®ã€‚
- **å®‰å…¨å¢å¼º**ï¼šç”Ÿæˆ HTML å†…è”è„šæœ¬çš„ JSON å­—é¢é‡æ—¶ï¼Œé¢å¤–è½¬ä¹‰ `</script`ï¼Œé¿å…å‰ªè´´æ¿å†…å®¹è§¦å‘è„šæœ¬æå‰é—­åˆå¯¼è‡´é¢„è§ˆå¤±æ•ˆ/æ³¨å…¥é£é™©ã€‚

### Why

- ç”¨æˆ·åé¦ˆï¼šè®ºæ–‡å¼ LaTeX ç‰‡æ®µï¼ˆå« `\\begin{equation}` / `\\begin{aligned}` / `\\tag{...}`ï¼‰ä»å­˜åœ¨æ¸²æŸ“ä¸æ­£ç¡®æˆ–ä¸ä¸€è‡´çš„é—®é¢˜ï¼›åŒæ—¶ hover é¢„è§ˆéœ€ä¿è¯â€œå†…å®¹ä¸å¯å½±å“è„šæœ¬ç»“æ„â€ã€‚

### Result

- `\\begin{equation}...\\end{equation}` ç­‰ç¯å¢ƒå—åœ¨ hover é¢„è§ˆä¸­æ›´æ¥è¿‘åŸå§‹è®ºæ–‡å†™æ³•çš„æ¸²æŸ“æ•ˆæœã€‚
- å³ä½¿å†…å®¹åŒ…å« `</script>` ç­‰æ•æ„Ÿç‰‡æ®µï¼Œé¢„è§ˆæ¸²æŸ“ä¹Ÿèƒ½ç¨³å®šæ‰§è¡Œä¸”ä¸ç ´åå®‰å…¨è¾¹ç•Œã€‚

---

## ğŸ—ï¸ å®ç°è¦ç‚¹

1. **KaTeX delimiter è¦†ç›–**ï¼šåœ¨ auto-render çš„ delimiters ä¸­è¡¥é½å¸¸è§ç¯å¢ƒï¼ˆ`equation/align/gather/multline/cases/split` åŠ `*` ç‰ˆæœ¬ï¼‰ã€‚
2. **å ä½ç¬¦ä¿æŠ¤ä¿æŒä¸å˜**ï¼šç»§ç»­åœ¨ Markdown è§£æå‰ä¿æŠ¤æ•°å­¦ç‰‡æ®µï¼Œé¿å… Markdown åˆ†æ®µ/å¼ºè°ƒè¯­æ³•ç ´åå…¬å¼ text nodeã€‚
3. **è„šæœ¬æ³¨å…¥é˜²æŠ¤**ï¼šå¯¹ JSON å­—é¢é‡åš `</script` case-insensitive è½¬ä¹‰ä¸º `<\\/script`ï¼Œç¡®ä¿ä¸ä¼šæå‰ç»ˆæ­¢ `<script>` æ ‡ç­¾ã€‚

---

## ğŸ“‚ ä¿®æ”¹æ–‡ä»¶

- `Scopy/Views/History/MarkdownHTMLRenderer.swift`
- `Scopy/Views/History/MathProtector.swift`
- `ScopyTests/MarkdownMathRenderingTests.swift`
- `doc/implemented-doc/README.md`
- `doc/implemented-doc/CHANGELOG.md`

---

## âœ… æµ‹è¯•ä¸æ„å»º

**æµ‹è¯•ç¯å¢ƒ**ï¼šApple M3ï¼ˆ24 GBï¼‰ / macOS 15.7.2ï¼ˆ24G325ï¼‰ / Debug / 2025-12-16

- å®šå‘å•æµ‹ï¼š`xcodebuild test -scheme Scopy -destination 'platform=macOS' -only-testing:ScopyTests/MarkdownMathRenderingTests` âœ…
- Release æ„å»ºï¼š`xcodebuild build -scheme Scopy -configuration Release -destination 'platform=macOS'` âœ…

