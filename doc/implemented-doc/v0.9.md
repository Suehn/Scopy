# v0.9 - App è¿‡æ»¤ä¸ Type è¿‡æ»¤åŠŸèƒ½

## ğŸ“Œ ä¸€é¡µçº¸æ€»ç»“

**What**: å®ç° App è¿‡æ»¤æŒ‰é’®ã€Type è¿‡æ»¤æŒ‰é’®ã€å¤§å†…å®¹ç©ºé—´æ¸…ç†åŠŸèƒ½

**Why**:
- v0.md 1.2 è¦æ±‚ï¼šé¡¶éƒ¨æœç´¢æ¡† + ç®€æ´è¿‡æ»¤æ§ä»¶ï¼ˆå¦‚ app è¿‡æ»¤æŒ‰é’®ï¼‰
- v0.md 1.2 è¦æ±‚ï¼štypeFilter æŒ‰å†…å®¹ç±»å‹è¿‡æ»¤
- v0.md 2.1 è¦æ±‚ï¼šå¤§å†…å®¹å¦å¤–é™åˆ¶æ¯”å¦‚ 800MB

**Result**:
- æœç´¢æ¡†æ—æ·»åŠ  App è¿‡æ»¤ä¸‹æ‹‰èœå•ï¼Œæ˜¾ç¤ºæœ€è¿‘ä½¿ç”¨çš„ 10 ä¸ª app
- æ·»åŠ  Type è¿‡æ»¤ä¸‹æ‹‰èœå•ï¼Œæ”¯æŒ Text/Image/File ç±»å‹è¿‡æ»¤
- å¤–éƒ¨å­˜å‚¨è¶…è¿‡ 800MB æ—¶è‡ªåŠ¨æ¸…ç†æœ€æ—§çš„å¤§æ–‡ä»¶

---

## ğŸ—ï¸ å®ç°è·¯çº¿

### Feature 1: App è¿‡æ»¤æŒ‰é’®

1. **ClipboardServiceProtocol** æ·»åŠ æ–¹æ³•
   - `getRecentApps(limit: Int) async throws -> [String]`

2. **StorageService** å®ç° app åˆ—è¡¨æŸ¥è¯¢
   ```sql
   SELECT app_bundle_id FROM clipboard_items
   WHERE app_bundle_id IS NOT NULL AND app_bundle_id != ''
   GROUP BY app_bundle_id
   ORDER BY MAX(last_used_at) DESC
   LIMIT ?
   ```

3. **RealClipboardService** å®ç° `getRecentApps()`
   - è°ƒç”¨ `storage.getRecentApps(limit:)`

4. **AppState** æ·»åŠ è¿‡æ»¤çŠ¶æ€
   - `appFilter: String?` - å½“å‰é€‰ä¸­çš„ app bundle ID
   - `recentApps: [String]` - æœ€è¿‘ä½¿ç”¨çš„ app åˆ—è¡¨
   - `loadRecentApps()` - åŠ è½½ app åˆ—è¡¨

5. **HeaderView** æ·»åŠ  App è¿‡æ»¤ä¸‹æ‹‰èœå•
   - æ˜¾ç¤º app å›¾æ ‡å’Œåç§°
   - æ¿€æ´»çŠ¶æ€æ˜¾ç¤ºè“è‰²æŒ‡ç¤ºå™¨
   - é€‰ä¸­çŠ¶æ€æ˜¾ç¤º checkmark

### Feature 2: Type è¿‡æ»¤æŒ‰é’®

1. **AppState** æ·»åŠ  typeFilter çŠ¶æ€
   - `typeFilter: ClipboardItemType?`

2. **HeaderView** æ·»åŠ  Type è¿‡æ»¤ä¸‹æ‹‰èœå•
   - æ”¯æŒ Text/Image/File ç±»å‹
   - ä¸ App è¿‡æ»¤å¯ç»„åˆä½¿ç”¨

3. **æœç´¢é€»è¾‘** æ”¯æŒè¿‡æ»¤å‚æ•°
   - `SearchRequest` ä¼ é€’ `appFilter` å’Œ `typeFilter`

### Feature 3: å¤§å†…å®¹ç©ºé—´æ¸…ç†

1. **StorageService.performCleanup()** æ·»åŠ å¤–éƒ¨å­˜å‚¨æ¸…ç†
   - æ£€æŸ¥å¤–éƒ¨å­˜å‚¨å¤§å°
   - è¶…è¿‡ 800MB é™åˆ¶æ—¶æ¸…ç†æœ€æ—§æ–‡ä»¶

2. **cleanupExternalStorage()** æ–¹æ³•
   - æŒ‰ last_used_at æ’åº
   - åˆ é™¤æœ€æ—§çš„å¤–éƒ¨å­˜å‚¨æ–‡ä»¶ç›´åˆ°ä½äºç›®æ ‡å¤§å°

---

## ğŸ“‚ æ ¸å¿ƒæ”¹åŠ¨

| æ–‡ä»¶ | æ”¹åŠ¨ |
|------|------|
| `Protocols/ClipboardServiceProtocol.swift` | æ·»åŠ  `getRecentApps()` æ–¹æ³• |
| `Services/StorageService.swift` | app åˆ—è¡¨æŸ¥è¯¢ + å¤–éƒ¨å­˜å‚¨æ¸…ç† + `cleanupExternalStorage()` |
| `Services/RealClipboardService.swift` | å®ç° `getRecentApps()` |
| `Services/MockClipboardService.swift` | Mock å®ç° |
| `Observables/AppState.swift` | `appFilter` + `typeFilter` + `recentApps` çŠ¶æ€ |
| `Views/HeaderView.swift` | App è¿‡æ»¤ + Type è¿‡æ»¤ä¸‹æ‹‰èœå• |
| `ScopyTests/AppStateTests.swift` | æ›´æ–° TestMockClipboardService |
| `ScopyTests/Helpers/MockServices.swift` | æ›´æ–° ReusableMockClipboardService |

---

## ğŸ¯ å…³é”®æŒ‡æ ‡

| æŒ‡æ ‡ | ç»“æœ |
|------|------|
| æ„å»ºçŠ¶æ€ | Debug âœ… |
| æµ‹è¯•çŠ¶æ€ | 48/48 passed (1 skipped) |
| App è¿‡æ»¤ | æ˜¾ç¤ºæœ€è¿‘ 10 ä¸ª app |
| Type è¿‡æ»¤ | Text/Image/File/RTF/HTML |
| å¤§å†…å®¹æ¸…ç† | 800MB é™åˆ¶ |

---

## ğŸ“Š å½“å‰çŠ¶æ€

```
é¡¹ç›®çŠ¶æ€æ£€æŸ¥:
  âœ… App è¿‡æ»¤æŒ‰é’®: æœç´¢æ¡†æ—ä¸‹æ‹‰èœå•
  âœ… Type è¿‡æ»¤æŒ‰é’®: å†…å®¹ç±»å‹è¿‡æ»¤
  âœ… å¤§å†…å®¹ç©ºé—´æ¸…ç†: 800MB é™åˆ¶
  âœ… è¿‡æ»¤ç»„åˆ: App + Type å¯åŒæ—¶ä½¿ç”¨

åŠŸèƒ½çŠ¶æ€:
  âœ… App å›¾æ ‡æ˜¾ç¤º: NSWorkspace.shared.icon(forFile:)
  âœ… App åç§°æ˜¾ç¤º: FileManager.displayName(atPath:)
  âœ… æ¿€æ´»æŒ‡ç¤ºå™¨: è“è‰²å°åœ†ç‚¹
  âœ… é€‰ä¸­çŠ¶æ€: checkmark æ ‡è®°
```

---

## ğŸ”® é—ç•™ä¸åç»­

### v0.md è¿›åº¦ Review

**å·²å®ç° âœ…**
- [x] å‰åç«¯åˆ†ç¦»æ¶æ„ (ClipboardServiceProtocol)
- [x] èœå•æ å›¾æ ‡ + å¿«æ·é”®å¼¹å‡º (â‡§âŒ˜Cï¼Œå¯è‡ªå®šä¹‰)
- [x] æœç´¢æ¡† + åˆ—è¡¨æ˜¾ç¤º
- [x] åˆ—è¡¨å³ä¾§ï¼šæ¥æº app å›¾æ ‡ / æ—¶é—´ / Pin æ ‡è®° (v0.8.1)
- [x] åˆ†çº§å­˜å‚¨ï¼ˆSQLite + å¤–éƒ¨æ–‡ä»¶ï¼‰
- [x] æ‡’åŠ è½½åˆ†é¡µ (é¦–å± 50 æ¡ï¼Œæ¯é¡µ 100 æ¡)
- [x] å»é‡ç­–ç•¥ (contentHash)
- [x] FTS5 æœç´¢
- [x] ä¸‰ç§æœç´¢æ¨¡å¼ï¼ˆexact/fuzzy/regexï¼‰
- [x] Pin åŠŸèƒ½
- [x] è®¾ç½®çª—å£ (æ¡æ•°/ç©ºé—´/å›¾ç‰‡/æ–‡ä»¶)
- [x] ç¼©ç•¥å›¾ç¼“å­˜ + LRU ç®¡ç† (v0.8)
- [x] å›¾ç‰‡æ‚¬æµ®é¢„è§ˆ (v0.8.1)
- [x] æŒ‰æ¡æ•°æ¸…ç†
- [x] æŒ‰æ—¶é—´æ¸…ç† (maxDaysAge)
- [x] æŒ‰ç©ºé—´æ¸…ç† (å°å†…å®¹)
- [x] æœç´¢é˜²æŠ– (searchTask å–æ¶ˆæœºåˆ¶)
- [x] **App è¿‡æ»¤æŒ‰é’®** (v0.9 æ–°å¢)
- [x] **Type è¿‡æ»¤æŒ‰é’®** (v0.9 æ–°å¢)
- [x] **å¤§å†…å®¹ç©ºé—´æ¸…ç†** (v0.9 æ–°å¢)

**æœªå®ç° âŒ**
- [ ] æ— ï¼ˆv0.md Phase 1 åŠŸèƒ½å·²å…¨éƒ¨å®ç°ï¼‰

### å·²çŸ¥é—®é¢˜
1. App å›¾æ ‡ä½ç½®ä¸ä¸€è‡´ï¼ˆtext ç±»å‹åœ¨å·¦ä¾§ï¼Œimage/file ç±»å‹åœ¨å³ä¾§ï¼‰
2. App è¿‡æ»¤é€‰é¡¹å¯èƒ½ä¸ºç©ºï¼ˆSQL è¯­æ³•é—®é¢˜ï¼‰
3. Type è¿‡æ»¤é€‰é¡¹è¿‡å¤šï¼ˆåŒ…å« RTF/HTMLï¼‰
4. Type è¿‡æ»¤æ»šåŠ¨æ—¶å¯èƒ½å–æ¶ˆ

### åç»­è®¡åˆ’
1. ä¿®å¤ä¸Šè¿°å·²çŸ¥é—®é¢˜ (v0.9.2)
2. æ€§èƒ½ä¼˜åŒ–
3. æ›´å¤š UI ç»†èŠ‚æ‰“ç£¨

---

**æœ€åæ›´æ–°**: 2025-11-27
**ç»´æŠ¤è€…**: Claude Code
