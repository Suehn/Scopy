# v0.43.1 性能对比（v0.43 → v0.43.1）

**日期**: 2025-12-14

## 对比版本

- v0.43 → v0.43.1

## 测试环境

- 设备：Apple M3
- 系统：macOS 15.7.2（24G325）
- 架构：arm64
- 配置：Debug
- 命令：`make test-perf`（`RUN_PERF_TESTS=1`）
- 备注：
  - heavy 场景需 `RUN_HEAVY_PERF_TESTS=1` 才运行
  - 本次 v0.43.1 采样运行时 **Low Power Mode enabled**（`pmset -g` 显示 `lowpowermode 1`），与 v0.43 基线不完全可比（更易出现整体放缓）

## 性能对比表格

| 指标 | v0.43 | v0.43.1 |
|------|------:|--------:|
| Fuzzy 5k items P95 | 7.11ms | 8.49ms |
| Fuzzy 10k items P95 | 51.88ms（Samples: 50） | 79.41ms（Samples: 50） |
| Disk 25k fuzzy P95 | 72.74ms（Samples: 50） | 102.93ms（Samples: 50） |
| Bulk insert 1000 items | 60.26ms（≈16,595 items/s） | 140.62ms（≈7,112 items/s） |
| Fetch recent (50 items) avg | 0.08ms | 0.11ms |
| Regex 20k items P95 | 3.87ms | 5.25ms |
| Mixed content disk search（single run） | 6.10ms | 7.56ms |

## 测试用例变化

- 调整：`PerformanceTests.testSearchPerformance10kItems` 在 Low Power Mode 下阈值自适应放宽（150ms → 300ms），减少“电源策略导致 CPU 降频”的误报。
- 稳定性：`PerformanceTests` 磁盘资源清理改为 async，避免 `@MainActor` + semaphore 的潜在死锁。

## 性能回归说明

- v0.43.1 的主要变更为“事件语义/热键应用/测试稳定性/避免主线程阻塞点”，不应显著改变搜索/存储核心热路径。
- 本次对比中多项指标较 v0.43 上浮，且采样时开启 Low Power Mode；更可能来源于系统电源策略而非代码回归。

## 总结

- v0.43.1 以稳定性与一致性修复为主；性能数据在 Low Power Mode 环境下出现整体放缓，但功能与回归测试均保持通过。
