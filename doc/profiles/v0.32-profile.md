# v0.32 性能对比（v0.31 → v0.32）

**日期**: 2025-12-13

## 对比版本

- v0.31 → v0.32

## 测试环境

- 设备：Apple M3
- 系统：macOS 15.7.2（24G325）
- 架构：arm64
- 配置：Debug
- 命令：`make test-perf`（`RUN_PERF_TESTS=1`）
- 备注：heavy 场景需 `RUN_HEAVY_PERF_TESTS=1` 才运行

## 性能对比表格

> 说明：v0.31 未留存同环境的 perf log，本次记录先给出 v0.32 的绝对值；后续可补跑 v0.31 同环境数据完成“严格对比”。

| 指标 | v0.31 | v0.32 |
|------|------:|------:|
| Fuzzy 5k items P95 | — | 4.85ms |
| Fuzzy 10k items P95 | — | 45.07ms |
| Disk 25k fuzzy P95 | — | 57.28ms |
| Bulk insert 1000 items | — | 54.73ms（≈18,272 items/s） |
| Fetch recent (50 items) avg | — | 0.07ms |
| Regex 20k items P95 | — | 3.39ms |

## 测试用例变化

- `ScopyTests/PerformanceTests.swift`：
  - heavy 场景改为 `RUN_HEAVY_PERF_TESTS=1` 显式开启（默认跳过）。
  - 磁盘用例清理时先关闭连接，避免 SQLite “vnode unlinked while in use” 警告干扰结果与稳定性。

## 性能回归说明

- 暂无同环境 v0.31 基线，无法给出严格“回归/提升”结论；当前 v0.32 指标仍满足 v0.md 的 5k/10k 搜索目标。

## 总结

- v0.32 的重点是并发/SQLite 访问模型的结构性修复（Search actor + 只读连接分离）；性能以 `make test-perf` 实测为准，heavy 场景可按需单独开启验证。

