# v0.59.fix1 - Performance Profile

日期：2026-01-19

环境：
- `hw.model=Mac15,12`
- macOS 26.3（25D5101c）
- Xcode 26.2（17C52）
- 真实库：`~/Library/Application Support/Scopy/clipboard.db`（≈ 145.9MB）

## 结论（摘要）

- 本版本以 **correctness/robustness** 为主：fullIndex 磁盘缓存增加 `*.sha256` 与 postings 校验；SearchEngine 增加 `mutation_seq` change token 兜底，代价是磁盘缓存加载路径多了一次校验开销（可接受且失败自动回退重建）。
- “prefilter + prewarm refine” 仍维持在几十毫秒级；冷启动直接 refine 仍由全量扫描成本主导。

## 指标

### 冷启动 refine（真实 DB，对照）

> v0.59 基线来自 `doc/implementation/releases/v0.59.md`（2026-01-13）。  
> v0.59.fix1 数据来自 `make test-real-db`（2026-01-19）。两次运行的 DB/系统 build 可能不同，Δ 仅作参考。

| 场景 | v0.59 | v0.59.fix1 | Δ |
|------|------:|-----------:|---:|
| prefilter（FTS） | ~1.30ms | ~2.06ms | +0.76ms |
| prefilter + 后台预热后 refine | ~16.33ms | ~18.09ms | +1.76ms |
| 冷启动直接 refine（无预热） | ~2305.90ms | ~3105.86ms | +799.96ms |
| 冷启动重建 refine（无缓存） | - | ~2274.50ms | - |
| 磁盘缓存加载 refine | ~861.03ms | ~905.25ms | +44.22ms |
| fullIndex 磁盘缓存文件 | ~38.8MB（v2） | ~39.1MB（v3，`*.sha256`） | +0.3MB |

## 测试命令

- 冷启动对照：`make test-real-db`
- 单测回归：`make test-unit`
- 并发回归：`make test-strict`
